if (self.CavalryLogger) { CavalryLogger.start_js(["OV+sJ"]); }

__d("PhotoProjection",[],(function a(b,c,d,e,f,g){f.exports={EQUIRECTANGULAR:"equirectangular",CUBESTRIP:"cubestrip",CYLINDRICAL:"cylindrical",TILED_CUBEMAP:"tiled_cubemap"};}),null);
__d('SphericalMediaCoreActions',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';var h={turnOn:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').TURN_ON};},turnOff:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').TURN_OFF};},enableSpherical:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').ENABLE_SPHERICAL};},disableSpherical:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').DISABLE_SPHERICAL};},requestPhoto:function i(){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').REQUEST_PHOTO};},requestPhotoFailed:function i(j,k){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').REQUEST_PHOTO_FAILED,data:{id:j,response:k}};},receivePhoto:function i(j,k){return {namespace:c('SphericalMediaActionNamespaces').CORE,type:c('SphericalMediaActions').RECEIVE_PHOTO,data:k};}};f.exports=h;}),null);
__d('SphericalMediaViewActions',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';f.exports={updateView:function h(i){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_VIEW,data:i};},updateViewport:function h(i,j){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_VIEWPORT,data:{yaw:i,pitch:j}};},updateFOV:function h(i){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_FOV,data:{fov:i}};},updateViewportAndFOV:function h(i,j,k){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').UPDATE_VIEWPORT_AND_FOV,data:{yaw:i,pitch:j,fov:k}};},startAnimating:function h(){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').START_ANIMATING};},stopAnimating:function h(){return {namespace:c('SphericalMediaActionNamespaces').VIEW,type:c('SphericalMediaActions').STOP_ANIMATING};}};}),null);
__d('SphericalMediaController.react',['cx','Event','React','SphericalViewportControl','SubscriptionsHandler','debounce','getElementRect','performanceNow','throttle','SphericalMediaConstants'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('SphericalMediaConstants').GYRO_SLIP_FACTOR,l=c('SphericalMediaConstants').LOGGER_SIGNIFICANT_MOVEMENT_DEGREE,m=c('SphericalMediaConstants').LOGGER_SIGNIFICANT_MOVEMENT_MS,n=c('SphericalMediaConstants').RB_FRICTION,o=c('SphericalMediaConstants').RB_SPRING_FACTOR,p=c('SphericalMediaConstants').RB_MAX_SPRING_DEGREE,q=c('SphericalMediaConstants').RB_MAX_STRETCH_X_DEGREE,r=c('SphericalMediaConstants').RB_MAX_STRETCH_Y_DEGREE,s=c('SphericalMediaConstants').TILED_CUBE_TILE_CONTENT_SIZE;i=babelHelpers.inherits(t,c('React').Component);j=i&&i.prototype;function t(u){j.constructor.call(this,u);this.$SphericalMediaController4=0;this.$SphericalMediaController6=false;this.onViewChange=function(){var v=this.__sphericalViewportControl;if(v&&!v.isUpdating()){var w=this.__getViewData(),x=v.getOrientation(),y=v.getVerticalFieldOfView(),z=w.fov!==y||w.pitch!==x.y||w.yaw!==x.x;if(z){v.updateViewport(w.yaw,w.pitch,w.fov);this.$SphericalMediaController5=babelHelpers['extends']({},w);}}}.bind(this);this.$SphericalMediaController7=function(){if(!this.$SphericalMediaController1)return;var v=c('getElementRect')(this.$SphericalMediaController1);if(v.left!==0||v.right!==0||v.top!==0||v.bottom!==0||v.height!==0||v.width!==0)this.$SphericalMediaController2={x:v.left,y:v.top};}.bind(this);this.$SphericalMediaController3=new (c('SubscriptionsHandler'))();this.$SphericalMediaController3.addSubscriptions(c('Event').listen(window,'resize',c('debounce')(this.$SphericalMediaController7)));}t.prototype.componentWillReceiveProps=function(u){if(u.isActive!==this.props.isActive&&!u.isActive)this.$SphericalMediaController8();if(u.isActive)if(u.width!==this.props.width||u.height!==this.props.height)this.$SphericalMediaController9(u.width,u.height);};t.prototype.componentDidMount=function(){this.props.isActive&&this.$SphericalMediaController10();};t.prototype.shouldComponentUpdate=function(u){var v=u.isActive&&!this.__sphericalViewportControl||u.width!==this.props.width||u.height!==this.props.height;return v;};t.prototype.componentDidUpdate=function(){if(this.props.isActive&&!this.__sphericalViewportControl)this.$SphericalMediaController10();this.$SphericalMediaController7();};t.prototype.componentWillUnmount=function(){this.$SphericalMediaController8();};t.prototype.$SphericalMediaController10=function(){var u=void 0;if(!this.$SphericalMediaController1)return;u=this.$SphericalMediaController1;var v=this.__getSphericalConfig(this.props),w=new (c('SphericalViewportControl'))(u,v,this.$SphericalMediaController11());this.$SphericalMediaController5={fov:v.fieldOfView,pitch:v.initialPitch,yaw:v.initialHeading};this.$SphericalMediaController7();w.addListener('updateViewportBegin',this.__onUpdateViewportBegin);w.addListener('updateViewportMoveStart',this.__onUpdateViewportMoveStart);w.addListener('DOM/click',this.__onDOMClick);w.addListener('updateViewportEnd',function(x,y){this.__onUpdateViewportEnd();this.$SphericalMediaController12();}.bind(this));w.addListener('viewportChange',this.__onViewportChange);w.addListener('zoomStart',this.__onZoomStart);w.addListener('mouseEnter',this.__onMouseEnter);w.addListener('mouseMove',c('throttle')(this.__onMouseMove));this.__sphericalViewportControl=w;this.$SphericalMediaController9(this.props.width,this.props.height);};t.prototype.$SphericalMediaController8=function(){this.$SphericalMediaController3.release();this.__sphericalViewportControl&&this.__sphericalViewportControl.destroy();this.__sphericalViewportControl=null;this.$SphericalMediaController6=true;};t.prototype.$SphericalMediaController12=function(){var u=c('performanceNow')();if(Math.abs(u-this.$SphericalMediaController4)<m)return;var v=this.$SphericalMediaController5;if(!v)return;var w=this.__getViewData(),x=w.yaw-v.yaw,y=w.pitch-v.pitch,z=Math.sqrt(Math.pow(x,2)+Math.pow(y,2));if(l<z){this.__onSignificantMove(w);this.$SphericalMediaController4=u;this.$SphericalMediaController5=babelHelpers['extends']({},w);}};t.prototype.$SphericalMediaController9=function(u,v,w){var x=this.__sphericalViewportControl;if(x){x.updateViewportClientSize({width:u,height:v});if(this.props.maxTileLevel>0){var y=Math.pow(2,this.props.maxTileLevel),z=s*y/90,aa=v/z/3;x.updateMinVFOV(aa);}var ba=this.__getViewData();x.setFieldOfView(ba.fov);var ca=x.getVerticalFieldOfView();if(ca!==ba.fov)this.__updateFOV(ca);}};t.prototype.$SphericalMediaController11=function(){return {disableAutoClientSizeUpdate:true,enableGyro:this.props.enableGyro,enableRubberBanding:this.props.enableRubberBanding,maxSpringDegrees:p,maxStretchXDegrees:q,maxStretchYDegrees:r,minVFOV:this.props.maxTileLevel,rubberBandConstant:n,slipFactor:k,springFactor:o};};t.prototype.__getSphericalConfig=function(u){var v=void 0;if(!u.isFullScreen)v=this.__getPartialLimits(u);var w=u.initialYaw,x=u.initialPitch,y=u.initialFov;if(this.$SphericalMediaController6){var z=this.__getViewData();y=z.fov;x=z.pitch;w=z.yaw;}return {initialHeading:w,initialPitch:x,fieldOfView:y,keyboardVelocityFactor:u.keyboardVelocityFactor,panningVelocityFactor:u.panningVelocityFactor,enableZoom:u.enableZoom,partialLimits:v||undefined};};t.prototype.__getPartialLimits=function(u){if(u.partialLeftDegrees||u.partialRightDegrees||u.partialTopDegrees||u.partialBottomDegrees)return {partialLeftDegrees:u.partialLeftDegrees,partialRightDegrees:u.partialRightDegrees,partialTopDegrees:u.partialTopDegrees,partialBottomDegrees:u.partialBottomDegrees};return null;};t.prototype.__getViewportMousePosition=function(u){if(!this.$SphericalMediaController2){this.$SphericalMediaController7();if(!this.$SphericalMediaController2)return null;}return {x:u.clientX-this.$SphericalMediaController2.x,y:u.clientY-this.$SphericalMediaController2.y};};t.prototype.__changeCursorStyle=function(u){if(!this.$SphericalMediaController1)return;this.$SphericalMediaController1.style.cursor=u;};t.prototype.render=function(){return c('React').createElement('div',{ref:function(u){return this.$SphericalMediaController1=u;}.bind(this),className:"_5nxw _25i_",tabIndex:0,'aria-label':this.props.caption});};f.exports=t;}),null);
__d('SphericalMediaRenderer.react',['cx','DOM','BackgroundImage.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;function k(l){j.constructor.call(this,l);this.$SphericalMediaRenderer2=false;this.$SphericalMediaRenderer3=false;if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var m in this.constructor.__subClassMethods)if(typeof this[m]!=='function')throw new Error('Must implement "'+m+'"');}k.prototype.componentWillReceiveProps=function(l){if(!l.isActive&&this.sphericalRenderer){this.__destroy();return;}};k.prototype.shouldComponentUpdate=function(l){return this.shouldRender;};k.prototype.componentDidMount=function(){this.$SphericalMediaRenderer4();};k.prototype.componentWillUnmount=function(){this.__destroy();};k.prototype.__destroy=function(){this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null;};k.prototype.$SphericalMediaRenderer4=function(){if(this.$SphericalMediaRenderer2||!this.__isReadyToSetup()||!this.$SphericalMediaRenderer1||this.$SphericalMediaRenderer3)return;this.$SphericalMediaRenderer3=true;var l=this.__getCanvas();this.__getRenderer(l).done(function(m){m.updateViewportDimensions(this.props.width,this.props.height);m.addListener('renderingError',function(n,o){return this.__onWebGlRenderFailed(n,o);}.bind(this));m.addListener('renderingContextLost',function(){return this.__onWebGlContextLost();}.bind(this));c('DOM').setContent(this.$SphericalMediaRenderer1,l);this.sphericalRenderer=m;m.renderErrorCheck();this.$SphericalMediaRenderer3=false;this.__onSetupDone(m);}.bind(this),function(m){this.$SphericalMediaRenderer2=true;this.$SphericalMediaRenderer3=false;this.__onWebGlInitFailed(m);return;}.bind(this));};k.prototype.draw=function(l){if(!this.sphericalRenderer)return;var m=this.sphericalRenderer;if(!m)return;try{m.render(l);this.__afterDraw(m);}catch(n){this.__onWebGlRenderFailed(n,l);return;}};k.prototype.componentDidUpdate=function(){if(!this.props.isActive)return;var l=this.sphericalRenderer;if(!l){this.$SphericalMediaRenderer4();}else{l.updateViewportDimensions(this.props.width,this.props.height);this.draw(this.__getViewData());}};k.prototype.render=function(){var l=void 0;if(this.props.thumbnail)l=c('React').createElement(c('BackgroundImage.react'),{className:!this.__showLoadingThumbnail()||this.props.isActive&&this.sphericalRenderer?"hidden_elem":'',src:this.props.thumbnail,width:this.props.width,height:this.props.height,backgroundSize:'cover'});return c('React').createElement('div',null,c('React').createElement('div',{className:!this.props.isActive||!this.sphericalRenderer?"hidden_elem":'',ref:function(m){return this.$SphericalMediaRenderer1=m;}.bind(this)}),l);};f.exports=k;}),null);
__d('SphericalMediaBaseStore',['ReduxThunk','Redux'],(function a(b,c,d,e,f,g){'use strict';var h=c('Redux').compose,i=c('Redux').applyMiddleware,j=c('Redux').createStore,k=c('Redux').combineReducers;function l(){var m=arguments.length<=0||arguments[0]===undefined?[]:arguments[0],n=i.apply(undefined,[c('ReduxThunk')].concat(m)),o=k(this.getReducers());this.$SphericalMediaBaseStore1=h(n)(j)(o);}l.prototype.getStore=function(){return this.$SphericalMediaBaseStore1;};l.prototype.getReducers=function(){throw new Error('Implement _getReducers');};f.exports=l;}),null);
__d('SphericalMediaViewReducer',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';var h={fov:65,pitch:0,yaw:0,isAnimating:false},i=function j(){var k=arguments.length<=0||arguments[0]===undefined?h:arguments[0],l=arguments[1];if(l.namespace!==c('SphericalMediaActionNamespaces').VIEW)return k;var m={};switch(l.type){case c('SphericalMediaActions').UPDATE_VIEW:m=l.data;break;case c('SphericalMediaActions').UPDATE_VIEWPORT_AND_FOV:var n=l.data,o=n.pitch,p=n.fov,q=n.yaw;if(!isNaN(o+p+q)){m.fov=p;m.pitch=o;m.yaw=q;}break;case c('SphericalMediaActions').UPDATE_VIEWPORT:m=l.data;break;case c('SphericalMediaActions').UPDATE_FOV:m.fov=l.data.fov;break;case c('SphericalMediaActions').START_ANIMATING:m.isAnimating=true;break;case c('SphericalMediaActions').STOP_ANIMATING:m.isAnimating=false;break;}return babelHelpers['extends']({},k,m);};f.exports=i;}),null);
__d('SphericalMediaViewStore',['SphericalMediaBaseStore','SphericalMediaViewReducer'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('SphericalMediaBaseStore'));i=h&&h.prototype;j.prototype.getReducers=function(){return {view:c('SphericalMediaViewReducer')};};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('SphericalMediaBaseRecord',['immutable','SphericalMediaViewStore','VideoProjection'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('VideoProjection').UNPADDED_CUBESTRIP,k=c('immutable').Record({keyboardVelocityFactor:0,panningVelocityFactor:0,enableGyro:false,enablePartialLimit:false,enableRubberBanding:false,enableZoom:false,partialLeftDegrees:undefined,partialRightDegrees:undefined,partialTopDegrees:undefined,partialBottomDegrees:undefined,isPanning:false,hasInteracted:false,visibility:true,aspectRatio:1,height:0,width:0,initialFov:65,initialPitch:0,initialYaw:0,renderer:null,isRendererActive:false,isRendererSetup:false,className:'',projectionType:j,expansionCoef:undefined,tiledSphericalConfig:{useTiledRenderer:false,initialTileUris:[],maxTileLevel:0},canvasNamespace:'SphericalMedia',caption:'',type:'photo',src:'',flatImage:'',originalImageURI:'',thumbnail:'',fbid:'',loaded:false,enableSpherical:true,isFetchingData:false,photoSphereMetadata:{},exif:{},useLocalSphericalImage:false,enableTagging:false,tags:[],tagUnderMouse:null,tagClicked:null,isTagging:false,tagger:null,taggingMode:false,targetedTag:null,surface:'',sessionID:'',viewStore:new (c('SphericalMediaViewStore'))().getStore()});h=babelHelpers.inherits(l,k);i=h&&h.prototype;function l(){h.apply(this,arguments);}f.exports=l;}),null);
__d('SphericalMediaBaseReducer',['SphericalMediaActionNamespaces','SphericalMediaActions','SphericalMediaBaseRecord','SphericalMediaViewStore'],(function a(b,c,d,e,f,g){'use strict';var h=function j(){return new (c('SphericalMediaBaseRecord'))({viewStore:new (c('SphericalMediaViewStore'))().getStore()});},i=function j(){var k=arguments.length<=0||arguments[0]===undefined?h():arguments[0],l=arguments[1];if(l.namespace!==c('SphericalMediaActionNamespaces').CORE&&l.namespace!==c('SphericalMediaActionNamespaces').BASE)return k;switch(l.type){case c('SphericalMediaActions').UPDATE_BASE:var m=l.data;return k.withMutations(function(y){y.merge(m);if(m.photoSphereMetadata)y.set('photoSphereMetadata',m.photoSphereMetadata);if(m.tiledSphericalConfig)y.set('tiledSphericalConfig',m.tiledSphericalConfig);if(m.tags)y.set('tags',m.tags);if(m.tagUnderMouse)y.set('tagUnderMouse',m.tagUnderMouse);if(m.tagClicked)y.set('tagClicked',m.tagClicked);if(m.tagger)y.set('tagger',m.tagger);if(m.exif)y.set('exif',m.exif);});case c('SphericalMediaActions').DRAG_START:return k.withMutations(function(y){y.set('isPanning',true);y.set('hasInteracted',true);});case c('SphericalMediaActions').VISIBILITY_CHANGED:return k.set('visibility',l.data);case c('SphericalMediaActions').UPDATE_INITIAL_FOV:return k.set('initialFov',l.data.initialFov);case c('SphericalMediaActions').UPDATE_INITIAL_VIEWPORT:var n=l.data;return k.withMutations(function(y){y.set('initialYaw',n.initialYaw);y.set('initialPitch',n.initialPitch);});case c('SphericalMediaActions').UPDATE_DIMENSION:var o=l.data;return k.withMutations(function(y){y.set('height',o.height);y.set('width',o.width);y.set('aspectRatio',o.width/o.height);});case c('SphericalMediaActions').SETUP_RENDERER:var p=l.data.renderer;return k.withMutations(function(y){y.set('isRendererSetup',true);y.set('renderer',p);});case c('SphericalMediaActions').TURN_ON:return k.set('isRendererActive',true);case c('SphericalMediaActions').TURN_OFF:return k.withMutations(function(y){y.set('isRendererActive',false);y.set('isRendererSetup',false);y.set('renderer',null);});case c('SphericalMediaActions').REPLACE_BASE_STATE:return l.data;case c('SphericalMediaActions').SOURCE_ONLOAD:return k.set('loaded',true);case c('SphericalMediaActions').DISABLE_SPHERICAL:return k.set('enableSpherical',false);case c('SphericalMediaActions').ENABLE_SPHERICAL:return k.set('enableSpherical',true);case c('SphericalMediaActions').REQUEST_PHOTO:return k.withMutations(function(y){y.set('loaded',false);y.set('isFetchingData',true);});case c('SphericalMediaActions').RECEIVE_PHOTO:var q=l.data,r=q.partialLimits;return k.withMutations(function(y){y.set('fbid',q.photoID);y.set('flatImage',q.flatImage);y.set('initialFov',q.initialFov);y.set('initialPitch',q.initialPitch);y.set('initialYaw',q.initialYaw);y.set('isFetchingData',false);y.set('originalImageURI',q.originalImageURI);y.set('partialBottomDegrees',r.partialBottomDegrees);y.set('partialLeftDegrees',r.partialLeftDegrees);y.set('partialRightDegrees',r.partialRightDegrees);y.set('partialTopDegrees',r.partialTopDegrees);y.set('src',q.src);y.set('thumbnail',q.thumbnail);y.set('photoSphereMetadata',q.photoSphereMetadata||{});});case c('SphericalMediaActions').ENABLE_TAGGING:return k.set('enableTagging',true);case c('SphericalMediaActions').DISABLE_TAGGING:return k.set('enableTagging',false);case c('SphericalMediaActions').UPDATE_SPATIAL_TAGS:var s=l.data;return k.withMutations(function(y){y.set('tags',s);});case c('SphericalMediaActions').UPDATE_TAG_UNDER_MOUSE:var t=l.data;return k.withMutations(function(y){y.set('tagUnderMouse',t);});case c('SphericalMediaActions').UPDATE_RESIZED_FILE_URL:var u=l.data;return k.withMutations(function(y){y.set('src',u);});case c('SphericalMediaActions').TAGGING_START:return k.set('isTagging',true);case c('SphericalMediaActions').TAGGING_STOP:return k.set('isTagging',false);case c('SphericalMediaActions').UPDATE_TAG_CLICKED:var v=l.data;return k.withMutations(function(y){y.set('tagClicked',v);});case c('SphericalMediaActions').UPDATE_TAGGER:var w=l.data;return k.withMutations(function(y){y.set('tagger',w);});case c('SphericalMediaActions').ENTER_TAGGING_MODE:return k.set('taggingMode',true);case c('SphericalMediaActions').EXIT_TAGGING_MODE:return k.set('taggingMode',false);case c('SphericalMediaActions').UPDATE_TARGETED_TAG:var x=l.data;return k.withMutations(function(y){y.set('targetedTag',x);});}return k;};f.exports=i;}),null);
__d('SphericalPhotoActions',['SphericalMediaActionNamespaces','SphericalMediaActions'],(function a(b,c,d,e,f,g){'use strict';f.exports={rendererStats:function h(i){return {namespace:c('SphericalMediaActionNamespaces').PHOTO,type:c('SphericalMediaActions').PHOTO_RENDERER_STATS,data:i};}};}),null);
__d('SphericalProjectionUtils',['invariant','degToRad','radToDeg','GLMatrix'],(function a(b,c,d,e,f,g,h){var i=c('GLMatrix').vec3,j=c('GLMatrix').mat4,k=15,l=.2,m={convert3dTo2dNormalized:function n(o,p,q,r,s,t,u){var v=c('degToRad')(o),w=c('degToRad')(p),x=c('degToRad')(q),y=c('degToRad')(r),z=c('degToRad')(s),aa=j.create();j.perspective(aa,z,t/u,.1,100);var ba=j.create();j.rotateX(ba,ba,w);j.rotateY(ba,ba,v);j.invert(ba,ba);var ca=j.create();j.rotateX(ca,ca,y);j.rotateY(ca,ca,x);j.multiply(ca,ca,ba);j.multiply(ca,aa,ca);var da=i.fromValues(0,0,-1);i.transformMat4(da,da,ca);var ea=.5+da[0]/2,fa=.5+da[1]/2;return {x:ea,y:fa,isNegativeTwin:da[2]>1};},convert3dTo2dScaled:function n(o,p,q,r,s,t,u){var v=m.convert3dTo2dNormalized.apply(m,arguments),w=v.x,x=v.y,y=v.isNegativeTwin;return {x:w*t,y:x*u,isNegativeTwin:y};},convert3dTo2dScaledUnique:function n(o,p,q,r,s,t,u){var v=m.convert3dTo2dNormalized.apply(m,arguments),w=v.x,x=v.y,y=v.isNegativeTwin;if(y){w=x=-1;}else{w*=t;x*=u;}return {x:w,y:x};},convert3dTo2dOnScreen:function n(o,p,q,r,s,t,u){var v=m.convert3dTo2dScaled.apply(m,arguments),w=v.x,x=v.y,y=v.isNegativeTwin;if(y){w=-w;x=p>0?-u:u;}w=Math.max(0,Math.min(t,w));x=Math.max(0,Math.min(u,x));return {x:w,y:x};},convert2dTo3dNormalized:function n(o,p,q,r,s,t,u){o<=1&&o>=-1||h(0);p<=1&&p>=-1||h(0);var v=c('degToRad')(q),w=c('degToRad')(r),x=c('degToRad')(s),y=j.create();j.perspective(y,x,t/u,.1,100);var z=-o/y[0],aa=-p/y[5],ba=v,ca=w,da=Math.atan(Math.tan(x/2)*y[5]/y[0]),ea=ba+(z<0?da:-da),fa=ca+(aa>0?x/2:-x/2),ga=void 0,ha=void 0,ia=void 0,ja=void 0,ka=void 0;ja=ka=ga=0;while(ga<k&&!(Math.abs(c('radToDeg')(ea-ba))<l&&Math.abs(c('radToDeg')(fa-ca))<l)){ga++;ha=(ba+ea)/2;ia=(ca+fa)/2;var la=m._getRelativePositionWithoutProjection(v,w,ha,ia),ma=la.x,na=la.y;if((aa-ka)*(aa-na)<=0){fa=ia;}else{ca=ia;ka=na;}if((z-ja)*(z-ma)<=0){ea=ha;}else{ba=ha;ja=ma;}}var oa=void 0,pa=void 0;if(ga<k){oa=Math.ceil(c('radToDeg')(ba));pa=Math.ceil(c('radToDeg')(ca));}else{oa=q;pa=r;}return {yaw:oa,pitch:pa};},convert2dTo3dScaled:function n(o,p,q,r,s,t,u){var v=t/2,w=u/2;return m.convert2dTo3dNormalized((o-v)*(2/t),(p-w)*(2/u),q,r,s,t,u);},_getRelativePositionWithoutProjection:function n(o,p,q,r){var s=(p-r)/2,t=(p+r)/2,u=Math.cos((o-q)/2),v=Math.sin((o-q)/2),w=Math.cos(s)*u,x=Math.sin(s)*u,y=Math.cos(t)*v,z=Math.sin(t)*v,aa=2*x*z+2*w*y,ba=2*y*z-2*w*x,ca=1-2*x*x-2*y*y;return {x:aa/ca,y:ba/ca};}};f.exports=m;}),null);
__d('SphericalMediaTaggingUtils',['SphericalProjectionUtils','degToRad','radToDeg','GLMatrix'],(function a(b,c,d,e,f,g){'use strict';var h=c('GLMatrix').vec3,i={getSpatialTagArea:function j(k,l,m){var n=m.h/l.fov,o={w:Math.abs(k.width_degree)*n,h:Math.abs(k.height_degree)*n},p=c('SphericalProjectionUtils').convert3dTo2dScaledUnique(k.center.yaw,k.center.pitch,l.yaw,l.pitch,l.fov,m.w,m.h);return {topLeft:{x:p.x-o.w/2,y:p.y-o.h/2},bottomRight:{x:p.x+o.w/2,y:p.y+o.h/2}};},isPointInTagArea:function j(k,l,m,n){var o=this.getSpatialTagArea(l,m,n);return !(o.topLeft.x>k.x||o.bottomRight.x<k.x||o.topLeft.y>k.y||o.bottomRight.y<k.y);},pointsToRectSize:function j(k){var l=k.topLeft,m=k.bottomRight;return {w:Math.abs(m.x-l.x),h:Math.abs(m.y-l.y)};},rectSizeToPoints:function j(k,l){return {topLeft:k,bottomRight:{x:k.x+Math.abs(l.w),y:k.y+Math.abs(l.h)}};},rectSizeToDegreeSize:function j(k,l,m){var n=Number(m.FullPanoHeightPixels),o=Number(m.FullPanoWidthPixels);return {widthDegree:k/o*360,heightDegree:l/n*180};},degreeSizeToRectSize:function j(k,l,m){var n=Number(m.FullPanoHeightPixels),o=Number(m.FullPanoWidthPixels);return {w:k/360*o,h:l/180*n};},yawPitchToPhotoXY:function j(k,l,m){var n=Number(m.PosePitchDegrees),o=Number(m.PoseRollDegrees),p=Number(m.CroppedAreaImageHeightPixels),q=Number(m.CroppedAreaImageWidthPixels),r=Number(m.CroppedAreaLeftPixels),s=Number(m.CroppedAreaTopPixels),t=Number(m.FullPanoHeightPixels),u=Number(m.FullPanoWidthPixels),v=this.yawPitchToVec3(k,l),w=[v.x,v.y,v.z];if(n!==0)h.rotateX(w,w,[0,0,0],-n);if(o!==0)h.rotateZ(w,w,[0,0,0],o);var x=this.vec3ToPhotoXY(w[0],w[1],w[2]),y=x.x*u-r,z=x.y*t-s,aa=y/q,ba=z/p;return {x:aa,y:ba};},photoXYToYawPitch:function j(k,l){var m=Number(l.PosePitchDegrees),n=Number(l.PoseRollDegrees),o=Number(l.CroppedAreaImageHeightPixels),p=Number(l.CroppedAreaImageWidthPixels),q=Number(l.CroppedAreaLeftPixels),r=Number(l.CroppedAreaTopPixels),s=Number(l.FullPanoHeightPixels),t=Number(l.FullPanoWidthPixels),u=k.x*p,v=k.y*o,w=(u+q)/t,x=(v+r)/s,y=this.photoXYToVec3(w,x),z=[y.x,y.y,y.z];if(n!==0)h.rotateZ(z,z,[0,0,0],-n);if(m!==0)h.rotateX(z,z,[0,0,0],m);return this.vec3ToYawPitch.apply(this,z);},yawPitchToVec3:function j(k,l){var m=c('degToRad')(k),n=c('degToRad')(90-l),o=Math.abs(k)>90?1:-1,p=Math.tan(m)*-o;if(!isFinite(p))return {x:1,y:0,z:0};var q=Math.sqrt(p*p+o*o)/Math.tan(n);if(!isFinite(q))return {x:0,y:1,z:0};return {x:p,y:q,z:o};},vec3ToYawPitch:function j(k,l,m){var n=Math.atan2(Math.sqrt(k*k+m*m),l),o=Math.atan2(k,-m);return {yaw:c('radToDeg')(o),pitch:90-c('radToDeg')(n)};},vec3ToPhotoXY:function j(k,l,m){var n=Math.abs(Math.atan2(l,Math.sqrt(k*k+m*m)));if(l>0&&n<0)n*=-1;if(l<0&&n>0)n*=-1;n=(-n+Math.PI/2)/Math.PI;var o=-1*Math.atan2(k,m);if(o<0)o+=2*Math.PI;o/=2*Math.PI;return {x:o,y:n};},photoXYToVec3:function j(k,l){var m=(l-.5)*Math.PI,n=Math.sin(m),o=Math.cos(m),p=(k-.75)*2*Math.PI,q=Math.sin(p),r=Math.cos(p);k=r*o;l=-n;var s=q*o;return {x:k,y:l,z:s};},normalizeComposerXYToPhotoXY:function j(k){return k/100;},normalizePhotoXYToComposerXY:function j(k){return k*100;},coordinatesAreClose:function j(k,l){var m=arguments.length<=2||arguments[2]===undefined?.001:arguments[2],n=Math.abs(k.x-l.x),o=Math.abs(k.y-l.y);return !(n>m||o>m);},compareTags:function j(k,l){return !(k.center.pitch!==l.center.pitch||k.center.vec3[0]!==l.center.vec3[0]||k.center.vec3[1]!==l.center.vec3[1]||k.center.vec3[2]!==l.center.vec3[2]||k.center.yaw!==l.center.yaw||k.centerXY.x!==l.centerXY.x||k.centerXY.y!==l.centerXY.y||k.height_degree!==l.height_degree||k.width_degree!==l.width_degree);},getSpatialTagFromFBID:function j(k,l){for(var m=0;m<l.length;m++)if(l[m].fbid==k)return l[m];return null;}};f.exports=i;}),null);
__d('SphericalPhotoController.redux',['DOM','FullScreen','SphericalMediaController.react','SphericalMediaTaggingUtils','SphericalProjectionUtils','UserAgent','goURI','normalizeDeltaYaw','ReactRedux','SphericalMediaViewActions','SphericalMediaBaseActions','SphericalMediaConstants'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('ReactRedux').connect,k=c('SphericalProjectionUtils').convert3dTo2dScaledUnique,l=c('SphericalMediaViewActions').stopAnimating,m=c('SphericalMediaViewActions').updateViewportAndFOV,n=c('SphericalMediaViewActions').updateFOV,o=c('SphericalMediaBaseActions').dragStart,p=c('SphericalMediaBaseActions').gyroStart,q=c('SphericalMediaBaseActions').mouseEnter,r=c('SphericalMediaBaseActions').significantMove,s=c('SphericalMediaBaseActions').taggingStart,t=c('SphericalMediaBaseActions').taggingStop,u=c('SphericalMediaBaseActions').updateBase,v=c('SphericalMediaBaseActions').updateTagClicked,w=c('SphericalMediaBaseActions').updateTagUnderMouse,x=c('SphericalMediaBaseActions').viewportClicked,y=c('SphericalMediaBaseActions').zoomStart,z=c('SphericalMediaConstants').UNTAGGED_FACEBOX;h=babelHelpers.inherits(aa,c('SphericalMediaController.react'));i=h&&h.prototype;function aa(ca){i.constructor.call(this,ca);this.$SphericalPhotoController2=function(){this.onViewChange();}.bind(this);this.__onUpdateViewportBegin=function(){this.props.viewStore.dispatch(l());}.bind(this);this.__onUpdateViewportMoveStart=function(da){var ea=this.props.dispatch;if(da){ea(p());}else ea(o());}.bind(this);this.__onDOMClick=function(da){if(this.props.enableTagging){this.props.taggingMode?this.$SphericalPhotoController6(da):this.$SphericalPhotoController7(da);var ea=this.$SphericalPhotoController5(da);this.props.dispatch(v(ea));}this.props.dispatch(x());}.bind(this);this.__onViewportChange=function(da,ea,fa){if(this.props.enableTagging){var ga=this.props,ha=ga.dispatch,ia=ga.isTagging,ja=ga.tagger;if(ia&&ja){ja.hideTagger();ha(t());}ha(v(null));}this.props.viewStore.dispatch(m(da,ea,fa));}.bind(this);this.__onZoomStart=function(){this.props.dispatch(y());}.bind(this);this.__onMouseEnter=function(){this.props.dispatch(q());}.bind(this);this.__onMouseMove=function(da){if(this.props.enableTagging){var ea=this.$SphericalPhotoController5(da);if(ea){if(ea.type!==z){this.__changeCursorStyle('pointer');}else this.__changeCursorStyle('crosshair');}else this.__changeCursorStyle(this.$SphericalPhotoController4());this.props.dispatch(w(this.$SphericalPhotoController5(da)));}}.bind(this);}aa.prototype.componentWillReceiveProps=function(ca){i.componentWillReceiveProps.call(this,ca);if(ca.isActive)if(this.__getPartialLimits(ca)!==null&&ca.isFullScreen!==this.props.isFullScreen)this.$SphericalPhotoController1(ca);if(ca.isTagging){this.__sphericalViewportControl&&this.__sphericalViewportControl.disableKeyboard();}else this.__sphericalViewportControl&&this.__sphericalViewportControl.enableKeyboard();};aa.prototype.shouldComponentUpdate=function(ca){var da=i.shouldComponentUpdate.call(this,ca)||this.props.tagger!==ca.tagger&&this.props.enableTagging;return da;};aa.prototype.componentDidMount=function(){i.componentDidMount.call(this);this.props.viewStore.subscribe(this.$SphericalPhotoController2);this.props.enableTagging&&this.$SphericalPhotoController3();};aa.prototype.componentDidUpdate=function(){i.componentDidUpdate.call(this);this.props.enableTagging&&this.$SphericalPhotoController3();};aa.prototype.$SphericalPhotoController3=function(){var ca=this.props.tagger;if(ca){var da=c('DOM').find(ca.tagger,'div.faceBox'),ea=[ca.viewer.stageActions,da];if(this.__sphericalViewportControl)this.__sphericalViewportControl.addNewLayers(ea);}};aa.prototype.$SphericalPhotoController1=function(ca){if(this.__sphericalViewportControl){this.__sphericalViewportControl.reconfigure(this.__getSphericalConfig(ca));ca.viewStore.dispatch(m(ca.initialYaw,ca.initialPitch,ca.initialFov));}};aa.prototype.$SphericalPhotoController4=function(){var ca='grab';if(c('UserAgent').isEngine('WebKit')){ca='-webkit-'+ca;}else if(c('UserAgent').isEngine('Gecko'))ca='-moz-'+ca;return ca;};aa.prototype.$SphericalPhotoController5=function(ca){var da=this.__getViewportMousePosition(ca);if(!da)return null;var ea=this.props.tags,fa=this.props.viewStore.getState(),ga=fa.view,ha=null;if(ea)ea.forEach(function(ia){if(c('SphericalMediaTaggingUtils').isPointInTagArea(da,ia,ga,{w:this.props.width,h:this.props.height}))ha=ia;}.bind(this));return ha;};aa.prototype.$SphericalPhotoController6=function(ca){if(!this.props.tagger)return;var da=this.$SphericalPhotoController5(ca),ea=this.__getViewData(),fa=this.props,ga=fa.width,ha=fa.height,ia=fa.photoSphereMetadata,ja=void 0,ka=void 0,la=void 0;if(da){if(da.type!==z&&da.url){c('goURI')(da.url,true);return;}if(da.type===z){var ma=da.center,na=ma.yaw,oa=ma.pitch;ja=k(na,oa,ea.yaw,ea.pitch,ea.fov,ga,ha);la=c('SphericalMediaTaggingUtils').yawPitchToPhotoXY(na,oa,ia);var pa=c('SphericalMediaTaggingUtils').getSpatialTagArea(da,ea,{w:ga,h:ha});ka=c('SphericalMediaTaggingUtils').pointsToRectSize(pa);}else return;}else{ja=this.__getViewportMousePosition(ca);ka={w:100};if(!ja)return;var qa=c('SphericalProjectionUtils').convert2dTo3dScaled(ja.x,ja.y,ea.yaw,ea.pitch,ea.fov,ga,ha);la=c('SphericalMediaTaggingUtils').yawPitchToPhotoXY(c('normalizeDeltaYaw')(qa.yaw),qa.pitch,ia);}this.props.tagger.addSpatialTag({screenPos:ja,photoXY:la,size:ka.w,fromTag:!!da,inTaggingMode:this.props.taggingMode},ca);this.props.dispatch(s());};aa.prototype.$SphericalPhotoController7=function(ca){var da=this.$SphericalPhotoController5(ca);if(da){if(da.type!==z&&da.url){c('goURI')(da.url,true);return;}else{if(!this.props.tagger)return;var ea=this.props,fa=ea.width,ga=ea.height,ha=ea.photoSphereMetadata,ia=da.center,ja=ia.yaw,ka=ia.pitch,la=this.__getViewData(),ma=k(ja,ka,la.yaw,la.pitch,la.fov,fa,ga),na=c('SphericalMediaTaggingUtils').yawPitchToPhotoXY(ja,ka,ha),oa=c('SphericalMediaTaggingUtils').getSpatialTagArea(da,la,{w:fa,h:ga}),pa=c('SphericalMediaTaggingUtils').pointsToRectSize(oa);this.props.tagger.addSpatialTag({screenPos:ma,photoXY:na,size:pa.w,fromTag:true,inTaggingMode:this.props.taggingMode},ca);this.props.dispatch(s());}}else if(this.props.isTagging){this.props.tagger.hideTagger();this.props.dispatch(t());}};aa.prototype.__onUpdateViewportEnd=function(){this.props.dispatch(u({isPanning:false}));};aa.prototype.__onSignificantMove=function(ca){this.props.dispatch(r(ca));};aa.prototype.__updateFOV=function(ca){this.props.viewStore.dispatch(n(ca));};aa.prototype.__getViewData=function(){var ca=this.props.viewStore.getState(),da=ca.view;return {fov:da.fov,pitch:da.pitch,yaw:da.yaw};};aa.__subClassMethods={__getViewData:true,__onUpdateViewportBegin:true,__onUpdateViewportMoveStart:true,__onDOMClick:true,__onUpdateViewportEnd:true,__onViewportChange:true,__onZoomStart:true,__onMouseEnter:true,__onMouseMove:true,__onSignificantMove:true,__updateFOV:true};var ba=function ca(da){return {caption:da.base.caption,enableGyro:da.base.enableGyro,enableRubberBanding:da.base.enableRubberBanding,enableTagging:da.base.enableTagging,enableZoom:da.base.enableZoom,height:da.base.height,initialFov:da.base.initialFov,initialPitch:da.base.initialPitch,initialYaw:da.base.initialYaw,isActive:da.base.isRendererActive,isFullScreen:c('FullScreen').isFullScreen(),isTagging:da.base.isTagging,keyboardVelocityFactor:da.base.keyboardVelocityFactor,maxTileLevel:da.base.tiledSphericalConfig.maxTileLevel,panningVelocityFactor:da.base.panningVelocityFactor,partialBottomDegrees:da.base.partialBottomDegrees,partialLeftDegrees:da.base.partialLeftDegrees,partialRightDegrees:da.base.partialRightDegrees,partialTopDegrees:da.base.partialTopDegrees,photoSphereMetadata:da.base.photoSphereMetadata,tagger:da.base.tagger,taggingMode:da.base.taggingMode,tags:da.base.tags,viewStore:da.base.viewStore,width:da.base.width};};f.exports=j(ba)(aa);}),null);
__d('CubemapImageTile',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j){this.$CubemapImageTile1=i;this.$CubemapImageTile2=j;}h.prototype.getInfo=function(){return this.$CubemapImageTile1;};h.prototype.getImg=function(){return this.$CubemapImageTile2;};f.exports=h;}),null);
__d('CubemapImageTileInfo',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j,k,l){this.level=i;this.face=j;this.col=k;this.row=l;}h.prototype.getKey=function(){return ''+this.level+'_'+this.face+'_'+this.col+'_'+this.row;};h.prototype.getInfoForOffsetLevel=function(i){var j=this.level-i;if(j<0)throw new Error('Invalid level offset for getKeyForOffsetLevel: '+i+', max offset: '+this.level);var k=Math.floor(this.col/Math.pow(2,i)),l=Math.floor(this.row/Math.pow(2,i));return new h(j,this.face,k,l);};f.exports=h;}),null);
__d('CubemapImageTileProvider',['CubemapImageTile','CubemapImageTileInfo','Map','performanceNow','SphericalMediaConstants'],(function a(b,c,d,e,f,g){'use strict';var h=c('SphericalMediaConstants').TILED_CUBE_FACES,i=c('SphericalMediaConstants').TILED_CUBE_TILE_CONTENT_SIZE,j=c('SphericalMediaConstants').TILED_CUBE_TILE_PADDING_PIXELS;function k(l,m){this.$CubemapImageTileProvider10=function(n,o,p){var q=new Image(),r=new (c('CubemapImageTile'))(n,q);q.crossOrigin='anonymous';q.onload=function(){return this.$CubemapImageTileProvider11(r,p);}.bind(this);q.src=o;}.bind(this);this.$CubemapImageTileProvider1=l;this.$CubemapImageTileProvider6=0;this.$CubemapImageTileProvider7={};this.$CubemapImageTileProvider2=false;this.$CubemapImageTileProvider3=[];this.$CubemapImageTileProvider4=[];this.$CubemapImageTileProvider5=new (c('Map'))();this.$CubemapImageTileProvider8=m;this.$CubemapImageTileProvider9();}k.prototype.getTileContentSize=function(){return i;};k.prototype.getTilePaddingPixels=function(){return j;};k.prototype.getTileTotalSize=function(){return 2*j+i;};k.prototype.getMaxTileLevel=function(){return this.$CubemapImageTileProvider8;};k.prototype.getTotalPixelsLoaded=function(){return this.$CubemapImageTileProvider6*Math.pow(this.getTileTotalSize(),2);};k.prototype.getBaseLevelImageTiles=function(){return this.$CubemapImageTileProvider5;};k.prototype.addBaseLevelReadyCallback=function(l){if(!this.$CubemapImageTileProvider2){this.$CubemapImageTileProvider3.push(l);}else l();};k.prototype.isBaseLevelReady=function(){return this.$CubemapImageTileProvider2;};k.prototype.loadTileImage=function(l,m,n){var o=l.getKey();if(o in this.$CubemapImageTileProvider7){m(this.$CubemapImageTileProvider7[o],n);}else this.$CubemapImageTileProvider1.getUriForTile(l,function(p,q){this.$CubemapImageTileProvider10(p,q,m);}.bind(this));};k.prototype.$CubemapImageTileProvider9=function(){this.$CubemapImageTileProvider4=[new (c('CubemapImageTileInfo'))(0,h.PLUS_X,0,0),new (c('CubemapImageTileInfo'))(0,h.MINUS_X,0,0),new (c('CubemapImageTileInfo'))(0,h.PLUS_Y,0,0),new (c('CubemapImageTileInfo'))(0,h.MINUS_Y,0,0),new (c('CubemapImageTileInfo'))(0,h.PLUS_Z,0,0),new (c('CubemapImageTileInfo'))(0,h.MINUS_Z,0,0)];this.$CubemapImageTileProvider4.forEach(function(l){return this.$CubemapImageTileProvider1.getUriForTile(l,this.$CubemapImageTileProvider10);}.bind(this));};k.prototype.$CubemapImageTileProvider11=function(l,m){var n=l.getInfo().getKey();this.$CubemapImageTileProvider7[n]=l;this.$CubemapImageTileProvider6++;if(!this.$CubemapImageTileProvider2){var o=this.$CubemapImageTileProvider4.every(function(p){return p.getKey() in this.$CubemapImageTileProvider7;}.bind(this));if(l.getInfo().level===0)this.$CubemapImageTileProvider5.set(l.getInfo().getKey(),l);if(o)this.$CubemapImageTileProvider12();}else m&&m(l,c('performanceNow')());};k.prototype.$CubemapImageTileProvider12=function(){this.$CubemapImageTileProvider2=true;this.$CubemapImageTileProvider3.forEach(function(l){return l();});};f.exports=k;}),null);
__d('BaseCubemapTileUriProvider',['invariant','CubemapImageTileInfo'],(function a(b,c,d,e,f,g,h){'use strict';i.prototype.getUriForTile=function(j,k){h(0);};function i(){}f.exports=i;}),null);
__d("XSphericalPhotoTileURIsAsyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/spherical_media\/photo\/tile\/",{});}),null);
__d('EntPhotoCubemapTileUriProvider',['Promise','BaseCubemapTileUriProvider','CubemapImageTileInfo','Map','XAsyncRequest','XSphericalPhotoTileURIsAsyncController','flattenPHPQueryData','throttle'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=200;h=babelHelpers.inherits(k,c('BaseCubemapTileUriProvider'));i=h&&h.prototype;function k(l,m){i.constructor.call(this);this.$EntPhotoCubemapTileUriProvider9=c('throttle')(function(){this.$EntPhotoCubemapTileUriProvider10(this.$EntPhotoCubemapTileUriProvider3);this.$EntPhotoCubemapTileUriProvider3=new (c('Map'))();}.bind(this),j);this.$EntPhotoCubemapTileUriProvider1=l;this.$EntPhotoCubemapTileUriProvider2=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider3=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider4=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider5=new (c('Map'))();this.$EntPhotoCubemapTileUriProvider7(m);this.$EntPhotoCubemapTileUriProvider6=0;}k.prototype.getUriForTile=function(l,m){var n=l.getKey(),o=this.$EntPhotoCubemapTileUriProvider2.get(n);if(!o){if(this.$EntPhotoCubemapTileUriProvider5.has(n))return;this.$EntPhotoCubemapTileUriProvider8({tileInfo:l,onURIfetched:m});}else m(l,o);};k.prototype.$EntPhotoCubemapTileUriProvider8=function(l){var m=l.tileInfo.getKey(),n=this.$EntPhotoCubemapTileUriProvider3.get(m),o=this.$EntPhotoCubemapTileUriProvider4.get(m);if(!n&&!o){this.$EntPhotoCubemapTileUriProvider3.set(m,l);this.$EntPhotoCubemapTileUriProvider9();}};k.prototype.$EntPhotoCubemapTileUriProvider10=function(l){if(l.size===0)return new (c('Promise'))(function(){});var m=[];l.forEach(function(o){var p=o.tileInfo;this.$EntPhotoCubemapTileUriProvider4.set(p.getKey(),p);m.push({level:p.level,face:p.face,col:p.col,row:p.row});}.bind(this));var n={photo_id:this.$EntPhotoCubemapTileUriProvider1,tile_info_list:m};return this.$EntPhotoCubemapTileUriProvider11(c('XSphericalPhotoTileURIsAsyncController').getURIBuilder().getURI(),n).then(function(o){this.$EntPhotoCubemapTileUriProvider7(o.payload);l.forEach(function(p){var q=p.tileInfo,r=p.onURIfetched,s=q.getKey(),t=this.$EntPhotoCubemapTileUriProvider2.get(s);if(t){r(q,t);}else this.$EntPhotoCubemapTileUriProvider5.set(s,true);this.$EntPhotoCubemapTileUriProvider4['delete'](s);}.bind(this));}.bind(this),function(o){}.bind(this));};k.prototype.$EntPhotoCubemapTileUriProvider11=function(l,m){return new (c('Promise'))(function(n,o){return new (c('XAsyncRequest'))(l).setMethod('POST').setData(c('flattenPHPQueryData')(m)).setHandler(n).setErrorHandler(o).send();});};k.prototype.$EntPhotoCubemapTileUriProvider7=function(l){l.forEach(function(m){var n=new (c('CubemapImageTileInfo'))(m.level,m.face,m.col,m.row);this.$EntPhotoCubemapTileUriProvider2.set(n.getKey(),m.uri);}.bind(this));};f.exports=k;}),null);
__d('StaticCubemapTileUriProvider',['BaseCubemapTileUriProvider','CubemapImageTileInfo','Map'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('BaseCubemapTileUriProvider'));i=h&&h.prototype;function j(k){i.constructor.call(this);this.$StaticCubemapTileUriProvider1=new (c('Map'))();k.forEach(function(l){var m=new (c('CubemapImageTileInfo'))(l.level,l.face,l.col,l.row);this.$StaticCubemapTileUriProvider1.set(m.getKey(),l.uri);}.bind(this));}j.prototype.getUriForTile=function(k,l){var m=k.getKey(),n=this.$StaticCubemapTileUriProvider1.get(m);n&&l(k,n);};f.exports=j;}),null);
__d('BaseRotatableWebGLRenderer',['EventEmitter','EventListener','getErrorNameFromWebGLErrorCode','performanceNow','Map','GLMatrix','radToDeg'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('GLMatrix').glMatrix,k=c('GLMatrix').mat4,l=Math.max(window.devicePixelRatio||1,1),m=179;h=babelHelpers.inherits(n,c('EventEmitter'));i=h&&h.prototype;function n(o){i.constructor.call(this);this.__handleContextLost=function(q){q.preventDefault();this.emit('renderingContextLost');this.__contextLost=true;}.bind(this);this.__handleContextRestore=function(q){this.__setup();this.emit('renderingContextRestore');}.bind(this);if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var p in this.constructor.__subClassMethods)if(typeof this[p]!=='function')throw new Error('Must implement "'+p+'"');this.__firstRenderTime=-1;this.__previousRenderFinishTime=-1;this.__sumOfRenderTimes=0;this.__framesRenderedCount=0;this.__sumTextureScreenRatioValues=0;this.__textureScreenRatioMillisCounted=0;this.__canvas=o;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__shaders=[];this.__contextLost=false;this.__horizontalFieldOfView=0;this.__verticalFieldOfView=0;this.__perspectiveMatrix=k.create();this.__rotationMatrix=k.create();this.__canvas.addEventListener('webglcontextlost',this.__handleContextLost);this.__canvas.addEventListener('webglcontextrestored',this.__handleContextRestore);}n.prototype.destroy=function(){this.__canvas.removeEventListener('webglcontextlost',this.__handleContextLost);this.__canvas.removeEventListener('webglcontextrestored',this.__handleContextRestore);this.__shaders.forEach(function(o){try{this.__gl.detachShader(this.__shaderProgram,o);}catch(p){}}.bind(this));this.__shaders=[];this.__clearCache();};n.prototype.updateFieldOfView=function(o){var p=Math.min(m,Math.min(o,m/this.__aspectRatio));this.__verticalFieldOfView=p;this.__updateHorizontalFieldOfView();this.__updatePerspective();};n.prototype.updateViewportDimensions=function(o,p){this.__canvas.width=o*l;this.__canvas.height=p*l;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__updateHorizontalFieldOfView();this.__updatePerspective();};n.prototype.hasRenderingContext=function(){return !this.__contextLost;};n.prototype.getScreenshotDataURL=function(o,p,q){if(!this.__gl||this.__contextLost)return '';this.render(o);return this.__canvas.toDataURL(p,q);};n.prototype.getAverageFrameRenderTimeMillis=function(){if(this.__framesRenderedCount===0)return 0;return this.__sumOfRenderTimes/this.__framesRenderedCount;};n.prototype.getMaxGPUMemoryUsedBytes=function(){return this.__getMaxGPUMemoryUsedBytes();};n.prototype.getAverageTextureToScreenPixelRatio=function(){if(this.__textureScreenRatioMillisCounted===0)return 0;return this.__sumTextureScreenRatioValues/this.__textureScreenRatioMillisCounted;};n.prototype.getTimeSinceFirstRenderMillis=function(){return c('performanceNow')()-this.__firstRenderTime;};n.prototype.renderErrorCheck=function(){this.__createTexture();};n.prototype.render=function(o){if(this.__contextLost)return;if(!this.__isValidView(o)){this.emit('renderingError',new Error('invalid view'),o);return;}var p=c('performanceNow')();if(this.__firstRenderTime===-1)this.__firstRenderTime=p;if(o.fov!==this.__verticalFieldOfView)this.updateFieldOfView(o.fov);k.identity(this.__rotationMatrix);k.rotateX(this.__rotationMatrix,this.__rotationMatrix,-j.toRadian(o.pitch));k.rotateY(this.__rotationMatrix,this.__rotationMatrix,j.toRadian(o.yaw));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);var q=this.__getPrevFrameTextureScreenRatio();this.__renderInternal();var r=c('performanceNow')();this.__sumOfRenderTimes+=r-p;this.__framesRenderedCount+=1;if(this.__previousRenderFinishTime>0){var s=2000,t=Math.min(r-this.__previousRenderFinishTime,s);this.__sumTextureScreenRatioValues+=t*q;this.__textureScreenRatioMillisCounted+=t;}this.__previousRenderFinishTime=r;};n.prototype.renderWithRotationMatrixForMSite=function(o){k.rotateX(o,o,j.toRadian(90));this.renderWithRotationMatrix(o);};n.prototype.renderWithRotationMatrix=function(o){if(this.__contextLost)return;this.__rotationMatrix=o;this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);this.__renderInternal();};n.prototype.__isValidView=function(o){return !Number.isNaN(o.fov+o.pitch+o.yaw);};n.prototype.__copyTextureToGLBuffer=function(o,p){var q=arguments.length<=2||arguments[2]===undefined?false:arguments[2],r=this.__getNewGLTexObj(p);this.__gl.pixelStorei(this.__gl.UNPACK_FLIP_Y_WEBGL,q);this.__gl.bindTexture(this.__gl.TEXTURE_2D,r);this.__gl.texImage2D(this.__gl.TEXTURE_2D,0,this.__gl.RGBA,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,o.image);var s=this.__gl.getError();if(s!==0)this.__emitRenderingError(s);return r;};n.prototype.__setup=function(){if(!this.__gl||!this.__contextLost){this.__gl=this.__getGL();this.__contextLost=false;}this.__gl.clearColor(0,0,0,1);this.updateViewportDimensions(this.__canvas.clientWidth,this.__canvas.clientHeight);var o=this.__initShaders();if(!o.success){var p=c('getErrorNameFromWebGLErrorCode')(this.__gl.getError());throw new Error('\n        Failed to intialize shaders: '+p+'\n        Error Message: '+o.error+'\n      ');}};n.prototype.__getGL=function(){if(this.__gl&&!this.__contextLost)return this.__gl;if(!b.WebGLRenderingContext)throw new Error('WebGLRenderingContext not available.');var o=['webgl','experimental-webgl','webkit-3d','moz-webgl'],p=null,q=null,r=c('EventListener').listen(this.__canvas,'webglcontextcreationerror',function(t){return q=t.statusMessage;});for(var s=0;s<o.length;s++){try{p=this.__canvas.getContext(o[s]);}catch(t){}if(p)break;}r.remove();if(!p){q=q||'Unknown error.';throw new Error('Failed to acquire 3D rendering context: '+q);}return p;};n.prototype.__updatePerspective=function(){k.perspective(this.__perspectiveMatrix,j.toRadian(this.__verticalFieldOfView),this.__aspectRatio,.1,100);this.__gl.viewport(0,0,this.__gl.drawingBufferWidth,this.__gl.drawingBufferHeight);};n.prototype.__initShaders=function(){this.__shaderProgram=this.__gl.createProgram();try{this.__attachShaders(this.__shaderProgram);}catch(p){return {success:false,error:'Shader: '+p.message};}this.__gl.linkProgram(this.__shaderProgram);var o=this.__gl.getProgramParameter(this.__shaderProgram,this.__gl.LINK_STATUS);if(!o)return {success:false,error:'No link. Could not initialize shaders'};this.__gl.useProgram(this.__shaderProgram);this.__setShaderMatrixPointers();this.__shaderProgramReady();return {success:true,error:''};};n.prototype.__setShaderMatrixPointers=function(){this.__shaderPMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderPerspectiveMatrixUniformName());this.__shaderRotMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderRotationMatrixUniformName());};n.prototype.__getShaderConfigs=function(){var o=new (c('Map'))();o.set(this.__gl.VERTEX_SHADER,this.__getVertexShaderScript());o.set(this.__gl.FRAGMENT_SHADER,this.__getFragmentShaderScript());return o;};n.prototype.__attachShaders=function(o){var p=this.__getShaderConfigs();p.forEach(function(q,r){var s=this.__gl.createShader(r);this.__gl.shaderSource(s,q);this.__gl.compileShader(s);if(!this.__gl.getShaderParameter(s,this.__gl.COMPILE_STATUS))throw new Error(this.__gl.getShaderInfoLog(s));this.__gl.attachShader(o,s);this.__shaders.push(s);}.bind(this));};n.prototype.__getNewGLTexObj=function(o){var p=this.__gl.createTexture();this.__gl.bindTexture(o,p);this.__gl.texParameteri(o,this.__gl.TEXTURE_MAG_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_MIN_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_S,this.__gl.CLAMP_TO_EDGE);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_T,this.__gl.CLAMP_TO_EDGE);this.__gl.bindTexture(o,null);return p;};n.prototype.__updateHorizontalFieldOfView=function(){var o=j.toRadian(this.__verticalFieldOfView),p=2*Math.atan(Math.tan(o/2)*this.__aspectRatio);this.__horizontalFieldOfView=c('radToDeg')(p);};n.prototype.__emitRenderingError=function(o){this.emit('renderingError',new Error('WebGL Error Code: '+o));};f.exports=n;}),null);
__d('TiledSphericalRenderer',['CubemapImageTileInfo','BaseRotatableWebGLRenderer','performanceNow','Map','GLMatrix','debounceCore','SphericalMediaConstants'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('GLMatrix').glMatrix,k=c('GLMatrix').mat4,l=c('GLMatrix').vec3,m=c('SphericalMediaConstants').TILED_CUBE_FACES,n=44;h=babelHelpers.inherits(o,c('BaseRotatableWebGLRenderer'));i=h&&h.prototype;function o(p,q,r){i.constructor.call(this,p);this.$TiledSphericalRenderer28=function(s,t){var u=s.getInfo().getKey();this.$TiledSphericalRenderer7.set(u,s);if(t!==this.$TiledSphericalRenderer9){this.$TiledSphericalRenderer9=this.$TiledSphericalRenderer8;setTimeout(this.$TiledSphericalRenderer29,0);}}.bind(this);this.$TiledSphericalRenderer30=c('debounceCore')(function(){return this.__renderInternal();}.bind(this),30);this.$TiledSphericalRenderer29=c('debounceCore')(function(){var s=this.$TiledSphericalRenderer7;this.$TiledSphericalRenderer7=new (c('Map'))();this.$TiledSphericalRenderer21().forEach(function(t){return setTimeout(function(){return this.$TiledSphericalRenderer31(t,s);}.bind(this),0);}.bind(this));}.bind(this),100);this.$TiledSphericalRenderer1=q;this.$TiledSphericalRenderer2=r;this.$TiledSphericalRenderer3=1;this.$TiledSphericalRenderer6=0;this.$TiledSphericalRenderer8=0;this.$TiledSphericalRenderer9=0;this.$TiledSphericalRenderer4=new (c('Map'))();this.$TiledSphericalRenderer5=new (c('Map'))();this.$TiledSphericalRenderer7=new (c('Map'))();this.$TiledSphericalRenderer10=[];this.$TiledSphericalRenderer18();this.__setup();}o.prototype.__clearCache=function(){this.$TiledSphericalRenderer5.forEach(function(p){this.__gl.deleteTexture(p);}.bind(this));this.$TiledSphericalRenderer5.clear();this.$TiledSphericalRenderer4.forEach(function(p){this.__gl.deleteTexture(p.texture);}.bind(this));this.$TiledSphericalRenderer4.clear();};o.prototype.__getShaderPerspectiveMatrixUniformName=function(){return 'uPMatrix';};o.prototype.__getShaderRotationMatrixUniformName=function(){return 'uRotationMatrix';};o.prototype.__shaderProgramReady=function(){this.$TiledSphericalRenderer13=this.__gl.getAttribLocation(this.__shaderProgram,'aVertexPosition');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer13);this.$TiledSphericalRenderer14=this.__gl.getAttribLocation(this.__shaderProgram,'aTextureCoord');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer14);this.$TiledSphericalRenderer15=this.__gl.getAttribLocation(this.__shaderProgram,'aBGTextureCoord');this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer15);var p=this.__gl.getUniformLocation(this.__shaderProgram,'uContentSampler'),q=this.__gl.getUniformLocation(this.__shaderProgram,'uBackgroundSampler'),r=0;this.$TiledSphericalRenderer16=this.__gl.TEXTURE0;var s=1;this.$TiledSphericalRenderer17=this.__gl.TEXTURE1;this.__gl.uniform1i(p,r);this.__gl.uniform1i(q,s);this.$TiledSphericalRenderer19();};o.prototype.__getVertexShaderScript=function(){return '\n      attribute vec3 aVertexPosition;\n      attribute vec2 aTextureCoord;\n      attribute vec2 aBGTextureCoord;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n\n      void main(void) {\n        gl_Position = uPMatrix * uRotationMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vTextureCoord = aTextureCoord;\n        vBGTextureCoord = aBGTextureCoord;\n      }\n    ';};o.prototype.__getFragmentShaderScript=function(){return '\n    #define PI 3.1415926538\n\n    // 1 degree blend zone\n    const highp float blendDist = PI / 180.0;\n\n    varying highp vec2 vTextureCoord;\n    varying highp vec2 vBGTextureCoord;\n\n    varying highp vec3 vCurrentRay;\n    uniform highp vec2 uHorizontalAngleBounds;\n    uniform highp vec2 uVerticleAngleBounds;\n\n    uniform sampler2D uContentSampler;\n    uniform sampler2D uBackgroundSampler;\n\n    void main(void) {\n      highp float x = vCurrentRay[0];\n      highp float y = vCurrentRay[1];\n      highp float z = vCurrentRay[2];\n      highp float hAngle = atan(x, -1.0 * z);\n      highp float vAngle = atan(y * inversesqrt(x*x + z*z));\n\n      // if current ray is inside the content bounds, use the content sampler\n      // to set the fragment color. if it is not within the bounds, use the\n      // background sampler to set the color.*\n\n      highp float hdist = 0.0;\n      highp float vdist = 0.0;\n      if (hAngle < uHorizontalAngleBounds[0]) {\n        hdist = uHorizontalAngleBounds[0] - hAngle;\n      } else if (hAngle > uHorizontalAngleBounds[1]) {\n        hdist = hAngle - uHorizontalAngleBounds[1];\n      }\n      if (vAngle < uVerticleAngleBounds[0]) {\n        vdist = uVerticleAngleBounds[0] - vAngle;\n      } else if (vAngle > uVerticleAngleBounds[1]) {\n        vdist = vAngle - uVerticleAngleBounds[1];\n      }\n      highp float maxDist = max(hdist, vdist);\n      if (maxDist > 0.0) {\n        // Inside this condition, our fragment is outside the content bounds.\n        // The distance outside the bound is represented by maxDist. It could\n        // be the horizontal or vertical distance from a bound, whichever is\n        // larger. We will use this distance to blend the content with the\n        // background, if the distance is smaller than blendDist. If it is\n        // larger than blendDist, we will use purely the background tex to\n        // set the color. If dist is within the blendDist, then we will set\n        // the color to the linearly weighted avg across the blend zone of the\n        // background and content colors.\n        //\n        highp vec4 bgColor = texture2D(\n          uBackgroundSampler,\n          vec2(vBGTextureCoord.s, vBGTextureCoord.t)\n        );\n        if (maxDist < blendDist) {\n          highp float contentWeight = (blendDist - maxDist) / blendDist;\n          highp vec4 contentColor = texture2D(\n            uContentSampler,\n            vec2(vTextureCoord.s, vTextureCoord.t)\n          );\n          gl_FragColor = mix(bgColor, contentColor, contentWeight);\n        } else {\n          // We are outside the blend zone. Just use background.\n          gl_FragColor = bgColor;\n        }\n      } else {\n        // In this condition, we are inside the content, so we just take the\n        // color from the content texture.\n        gl_FragColor = texture2D(\n          uContentSampler,\n          vec2(vTextureCoord.s, vTextureCoord.t)\n        );\n      }\n    }\n    ';};o.prototype.__getMaxGPUMemoryUsedBytes=function(){var p=this.$TiledSphericalRenderer1.getTileTotalSize(),q=4,r=this.$TiledSphericalRenderer4.size+this.$TiledSphericalRenderer5.size;return p*p*q*r;};o.prototype.__getPrevFrameTextureScreenRatio=function(){return this.$TiledSphericalRenderer6;};o.prototype.__createTexture=function(){if(this.$TiledSphericalRenderer5.size===0&&this.$TiledSphericalRenderer1.isBaseLevelReady())this.$TiledSphericalRenderer20();};o.prototype.__renderInternal=function(){if(!this.$TiledSphericalRenderer1.isBaseLevelReady())return;this.__createTexture();this.$TiledSphericalRenderer8=c('performanceNow')();var p=this.$TiledSphericalRenderer21(),q=0;p.forEach(function(s){q+=this.$TiledSphericalRenderer22(s);}.bind(this));var r=p.length>0?p.length:1;q/=r;this.$TiledSphericalRenderer6=q;};o.prototype.$TiledSphericalRenderer19=function(){var p=this.__gl.getUniformLocation(this.__shaderProgram,'uHorizontalAngleBounds'),q=this.__gl.getUniformLocation(this.__shaderProgram,'uVerticleAngleBounds'),r=this.$TiledSphericalRenderer2.partialLeftDegrees,s=this.$TiledSphericalRenderer2.partialRightDegrees,t=this.$TiledSphericalRenderer2.partialTopDegrees,u=this.$TiledSphericalRenderer2.partialBottomDegrees,v=r!==undefined&&r!==null?-1*r:-181,w=s!==undefined&&s!==null?s:181,x=u!==undefined&&u!==null?-1*u:-91,y=t!==undefined&&t!==null?t:91,z=new Float32Array([j.toRadian(v),j.toRadian(w)]),aa=new Float32Array([j.toRadian(x),j.toRadian(y)]);this.__gl.uniform2fv(p,z);this.__gl.uniform2fv(q,aa);};o.prototype.$TiledSphericalRenderer21=function(){var p=this.$TiledSphericalRenderer23(),q=this.$TiledSphericalRenderer24(),r=Math.pow(2,p),s=2*this.$TiledSphericalRenderer3/r,t=[];for(var u=0;u<q.length;u++){var v=q[u];if(v){var w=Math.floor(v.minX/s),x=Math.min(Math.floor(v.maxX/s),r-1),y=Math.floor(v.minY/s),z=Math.min(Math.floor(v.maxY/s),r-1);for(var aa=w;aa<=x;aa++)for(var ba=y;ba<=z;ba++)t.push(new (c('CubemapImageTileInfo'))(p,u,aa,ba));}}return t;};o.prototype.$TiledSphericalRenderer23=function(){var p=this.__verticalFieldOfView,q=this.__horizontalFieldOfView,r=this.__canvas.height/p,s=3400/2,t=0,u=this.$TiledSphericalRenderer1.getTileContentSize()/90,v=1.4;while(u*v<r&&u*p<s&&u*q<s){t++;u*=2;}return Math.min(t,this.$TiledSphericalRenderer1.getMaxTileLevel());};o.prototype.$TiledSphericalRenderer24=function(){var p=j.toRadian(this.__verticalFieldOfView),q=j.toRadian(this.__horizontalFieldOfView),r=1,s=Math.tan(q/2)*r,t=Math.tan(p/2)*r,u=[l.fromValues(-s,t,-r),l.fromValues(s,t,-r),l.fromValues(s,-t,-r),l.fromValues(-s,-t,-r)],v=k.create();k.invert(v,this.__rotationMatrix);this.$TiledSphericalRenderer25(v,u);var w=[];for(var x=0;x<6;x++){var y=this.$TiledSphericalRenderer12[x],z=[];for(var aa=0;aa<y.length;aa++)z.push(l.clone(y[aa]));var ba=this.$TiledSphericalRenderer26(z,u);if(ba.length>0){var ca=k.create();k.invert(ca,this.$TiledSphericalRenderer11[x]);this.$TiledSphericalRenderer25(ca,ba);var da=ba[0],ea=da[0],fa=da[0],ga=da[1],ha=da[1];for(var ia=1;ia<ba.length;ia++){da=ba[ia];ea=Math.min(ea,da[0]);fa=Math.max(fa,da[0]);ga=Math.min(ga,da[1]);ha=Math.max(ha,da[1]);}w[x]={minX:this.$TiledSphericalRenderer3+ea,maxX:this.$TiledSphericalRenderer3+fa,minY:this.$TiledSphericalRenderer3-ha,maxY:this.$TiledSphericalRenderer3-ga};}}return w;};o.prototype.$TiledSphericalRenderer25=function(p,q){for(var r=0;r<q.length;r++)l.transformMat4(q[r],q[r],p);};o.prototype.$TiledSphericalRenderer26=function(p,q){var r=q[q.length-1];for(var s=0;s<q.length;s++){var t=q[s],u=[],v=l.create();l.cross(v,r,t);var w=p[p.length-1],x=l.dot(v,w),y=x>=0;for(var z=0;z<p.length;z++){var aa=p[z],ba=l.dot(v,aa),ca=ba>=0;if(ca!==y){var da=this.$TiledSphericalRenderer27(w,x,aa,ba);if(!l.exactEquals(w,da)&&!l.exactEquals(aa,da))u.push(da);}if(ca)u.push(aa);w=aa;x=ba;y=ca;}p=u;if(p.length===0)break;r=t;}return p;};o.prototype.$TiledSphericalRenderer27=function(p,q,r,s){var t=-q/(s-q),u=l.create();l.subtract(u,r,p);l.scale(u,u,t);l.add(u,u,p);return u;};o.prototype.$TiledSphericalRenderer31=function(p,q){var r=p.getKey(),s=q.get(r);if(s){this.$TiledSphericalRenderer32(s);this.$TiledSphericalRenderer30();}};o.prototype.$TiledSphericalRenderer22=function(p){var q=2*this.$TiledSphericalRenderer3,r=this.$TiledSphericalRenderer3,s=Math.pow(2,p.level),t=q/s,u=p.col*t,v=p.row*t,w=-r+u,x=w+t,y=r-v,z=y-t,aa=[[w,y,-r],[x,y,-r],[w,z,-r],[x,z,-r]],ba=this.$TiledSphericalRenderer11[p.face],ca=[];for(var da=0;da<aa.length;da++){l.transformMat4(aa[da],aa[da],ba);ca.push(aa[da][0]);ca.push(aa[da][1]);ca.push(aa[da][2]);}this.$TiledSphericalRenderer33(this.$TiledSphericalRenderer13,ca,3);this.__gl.activeTexture(this.$TiledSphericalRenderer16);var ea=this.$TiledSphericalRenderer34(p),fa=this.$TiledSphericalRenderer35(p,ea);this.$TiledSphericalRenderer33(this.$TiledSphericalRenderer14,fa,2);this.__gl.activeTexture(this.$TiledSphericalRenderer17);var ga=new (c('CubemapImageTileInfo'))(0,p.face,0,0),ha=this.$TiledSphericalRenderer5.get(ga.getKey());if(!ha)throw new Error('[Tile] Base level should have been loaded.');this.__gl.bindTexture(this.__gl.TEXTURE_2D,ha);var ia=this.$TiledSphericalRenderer35(p,ga);this.$TiledSphericalRenderer33(this.$TiledSphericalRenderer15,ia,2);this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,ca.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledSphericalRenderer10.forEach(function(ja){this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,ja);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,1,this.__gl.STATIC_DRAW);this.__gl.deleteBuffer(ja);}.bind(this));this.$TiledSphericalRenderer10=[];return this.$TiledSphericalRenderer36(ea.level);};o.prototype.$TiledSphericalRenderer33=function(p,q,r){var s=this.__gl.createBuffer();this.$TiledSphericalRenderer10.push(s);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,s);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(q),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(p,r,this.__gl.FLOAT,false,0,0);};o.prototype.$TiledSphericalRenderer36=function(p){var q=this.__canvas.height/this.__verticalFieldOfView,r=90/Math.pow(2,p),s=this.$TiledSphericalRenderer1.getTileContentSize()/r;return s/q;};o.prototype.$TiledSphericalRenderer35=function(p,q){var r=this.$TiledSphericalRenderer1.getTilePaddingPixels(),s=r/this.$TiledSphericalRenderer1.getTileTotalSize(),t=this.$TiledSphericalRenderer1.getTileContentSize()/this.$TiledSphericalRenderer1.getTileTotalSize(),u=Math.pow(2,p.level-q.level),v=t/u,w=p.col-u*q.col,x=p.row-u*q.row,y=s+w*v,z=s+x*v;return [y,z,y+v,z,y,z+v,y+v,z+v];};o.prototype.$TiledSphericalRenderer34=function(p){var q=0;while(q<=p.level){var r=p.getInfoForOffsetLevel(q),s=r.getKey(),t=void 0;if(r.level===0){t={lastUsedTime:0,texture:this.$TiledSphericalRenderer5.get(s)};}else t=this.$TiledSphericalRenderer4.get(s);if(t){this.__gl.bindTexture(this.__gl.TEXTURE_2D,t.texture);t.lastUsedTime=this.$TiledSphericalRenderer8;return r;}else this.$TiledSphericalRenderer1.loadTileImage(r,this.$TiledSphericalRenderer28,this.$TiledSphericalRenderer8);q++;}throw new Error('No possible tile for requested params: '+p.getKey());};o.prototype.$TiledSphericalRenderer20=function(){var p=this.$TiledSphericalRenderer1.getBaseLevelImageTiles();p.forEach(function(q){var r=this.__copyTextureToGLBuffer({image:q.getImg()},this.__gl.TEXTURE_2D),s=this.__gl.getError();if(s!==0)this.__emitRenderingError(s);this.$TiledSphericalRenderer5.set(q.getInfo().getKey(),r);}.bind(this));};o.prototype.$TiledSphericalRenderer32=function(p){var q,r=this,s=p.getInfo().getKey(),t=this.$TiledSphericalRenderer4.get(s);if(!t){var u=this.__copyTextureToGLBuffer({image:p.getImg()},this.__gl.TEXTURE_2D),v=this.__gl.getError();if(v!==0)this.emit('renderingError','WebGL Error Code: '+v);t={texture:u,lastUsedTime:c('performanceNow')()};this.$TiledSphericalRenderer4.set(s,t);if(this.$TiledSphericalRenderer4.size>n)(function(){var w=s,x=t;r.$TiledSphericalRenderer4.forEach(function(y,z){if(y.lastUsedTime<x.lastUsedTime){w=z;x=y;}});r.__gl.deleteTexture(x.texture);r.$TiledSphericalRenderer4['delete'](w);})();}};o.prototype.$TiledSphericalRenderer18=function(){this.$TiledSphericalRenderer11=[];var p=k.create();k.identity(p);k.rotateY(p,p,j.toRadian(-90));this.$TiledSphericalRenderer11[m.PLUS_X]=p;var q=k.create();k.identity(q);k.rotateY(q,q,j.toRadian(90));this.$TiledSphericalRenderer11[m.MINUS_X]=q;var r=k.create();k.identity(r);k.rotateZ(r,r,j.toRadian(180));k.rotateX(r,r,j.toRadian(-90));this.$TiledSphericalRenderer11[m.PLUS_Y]=r;var s=k.create();k.identity(s);k.rotateZ(s,s,j.toRadian(180));k.rotateX(s,s,j.toRadian(90));this.$TiledSphericalRenderer11[m.MINUS_Y]=s;var t=k.create();k.identity(t);k.rotateY(t,t,j.toRadian(180));this.$TiledSphericalRenderer11[m.PLUS_Z]=t;var u=k.create();k.identity(u);this.$TiledSphericalRenderer11[m.MINUS_Z]=u;this.$TiledSphericalRenderer12=[];var v=this.$TiledSphericalRenderer3,w=[l.fromValues(-v,v,-v),l.fromValues(v,v,-v),l.fromValues(v,-v,-v),l.fromValues(-v,-v,-v)];for(var x=0;x<6;x++){var y=this.$TiledSphericalRenderer11[x],z=[];for(var aa=0;aa<w.length;aa++){var ba=l.create();l.transformMat4(ba,w[aa],y);z.push(ba);}this.$TiledSphericalRenderer12[x]=z;}};o.__subClassMethods={__getFragmentShaderScript:true,__getVertexShaderScript:true,__getShaderPerspectiveMatrixUniformName:true,__getShaderRotationMatrixUniformName:true,__renderInternal:true,__shaderProgramReady:true,__getMaxGPUMemoryUsedBytes:true,__getPrevFrameTextureScreenRatio:true,__createTexture:true,__clearCache:true};f.exports=o;}),null);
__d('getScaledPanoDimensions',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k={croppedAreaImageHeightPixels:Number(i.CroppedAreaImageHeightPixels)||0,croppedAreaImageWidthPixels:Number(i.CroppedAreaImageWidthPixels)||0,croppedAreaLeftPixels:Number(i.CroppedAreaLeftPixels)||0,croppedAreaTopPixels:Number(i.CroppedAreaTopPixels)||0,fullPanoHeightPixels:Number(i.FullPanoHeightPixels)||0,fullPanoWidthPixels:Number(i.FullPanoWidthPixels)||0};if(k.croppedAreaImageWidthPixels&&j!==k.croppedAreaImageWidthPixels){var l=j/k.croppedAreaImageWidthPixels;k.croppedAreaImageWidthPixels*=l;k.croppedAreaImageHeightPixels*=l;k.croppedAreaLeftPixels*=l;k.croppedAreaTopPixels*=l;k.fullPanoHeightPixels*=l;k.fullPanoWidthPixels*=l;}return k;}f.exports=h;}),null);
__d('SphericalPhotoRenderer.redux',['cx','Promise','Bootloader','CubemapImageTileProvider','DOM','EntPhotoCubemapTileUriProvider','Event','ImageUtils','PhotoProjection','SphericalMediaCanvasPool','SphericalMediaRenderer.react','StaticCubemapTileUriProvider','TiledSphericalRenderer','joinClasses','performanceNow','uniqueID','getScaledPanoDimensions','ReactRedux','SphericalMediaCoreActions','SphericalMediaViewActions','SphericalMediaBaseActions','SphericalPhotoActions'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('ReactRedux').connect,l=c('SphericalMediaCoreActions').turnOff,m=c('SphericalMediaViewActions').updateViewportAndFOV,n=c('SphericalMediaBaseActions').updateBase,o=c('SphericalMediaBaseActions').setupRenderer,p=c('SphericalMediaBaseActions').webGlInitFailed,q=c('SphericalMediaBaseActions').webGlRenderFailed,r=c('SphericalMediaBaseActions').webGlContextLost,s=c('SphericalMediaBaseActions').sourceOnLoad,t=c('SphericalPhotoActions').rendererStats,u=2;i=babelHelpers.inherits(v,c('SphericalMediaRenderer.react'));j=i&&i.prototype;function v(x){j.constructor.call(this,x);this.$SphericalPhotoRenderer10=function(){this.draw(this.__getViewData());}.bind(this);this.__sourceElement=c('DOM').create('img');this.$SphericalPhotoRenderer1=c('uniqueID')();this.$SphericalPhotoRenderer2=0;this.$SphericalPhotoRenderer3=null;}v.prototype.__afterDraw=function(){};v.prototype.__beforeCanvasLost=function(){this.$SphericalPhotoRenderer4();this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null;if(this.props.isActive)this.props.dispatch(l());};v.prototype.__getViewData=function(){var x=this.props.viewStore.getState(),y=x.view;return {fov:y.fov,pitch:y.pitch,yaw:y.yaw};};v.prototype.__getCanvas=function(){var x=this.$SphericalPhotoRenderer5();c('SphericalMediaCanvasPool').setLimit(u,x);var y={canvasAttrs:{width:this.props.width,height:this.props.height,className:c('joinClasses')(this.props.className,"_5nxw")},beforeCanvasLost:function(){return this.__beforeCanvasLost();}.bind(this)};return c('SphericalMediaCanvasPool').get(this.$SphericalPhotoRenderer1,y,x);};v.prototype.__onSetupDone=function(){this.$SphericalPhotoRenderer6();};v.prototype.__isReadyToSetup=function(){return this.props.isActive&&this.props.imageLoaded;};v.prototype.__onWebGlRenderFailed=function(x,y){this.props.dispatch(q(x,y));};v.prototype.__onWebGlContextLost=function(){this.props.dispatch(r());this.props.dispatch(l());};v.prototype.__onWebGlInitFailed=function(x){c('SphericalMediaCanvasPool').release(this.$SphericalPhotoRenderer1,this.props.canvasNamespace);this.props.dispatch(p(x));this.props.dispatch(l());};v.prototype.__getRenderer=function(x){return new (c('Promise'))(function(y,z){var aa,ba=this;if(this.props.tiledSphericalConfig.useTiledRenderer&&this.__cubemapImageTileProvider){y(new (c('TiledSphericalRenderer'))(x,this.__cubemapImageTileProvider,{partialLeftDegrees:this.props.partialLeftDegrees,partialRightDegrees:this.props.partialRightDegrees,partialTopDegrees:this.props.partialTopDegrees,partialBottomDegrees:this.props.partialBottomDegrees}));}else (function(){if(!ba.props.imageLoaded)throw new Error('__getRenderer was called before the source has been loaded.');var ca=ba.props,da=ca.projectionType,ea=ca.photoSphereMetadata,fa=c('getScaledPanoDimensions')(ea,ba.__sourceElement.width);if(da===c('PhotoProjection').EQUIRECTANGULAR){c('Bootloader').loadModules(["EquirectSphericalWebGLRenderer"],function(ga){try{y(new ga(this.__sourceElement,x,babelHelpers['extends']({poseHeadingDegrees:Number(ea.PoseHeadingDegrees)||0,posePitchDegrees:Number(ea.PosePitchDegrees)||0,poseRollDegrees:Number(ea.PoseRollDegrees)||0},fa)));}catch(ha){z(ha);}}.bind(ba),'SphericalPhotoRenderer.redux');}else if(da===c('PhotoProjection').CYLINDRICAL){c('Bootloader').loadModules(["CylindricalSphericalWebGLRenderer"],function(ga){try{y(new ga(this.__sourceElement,x,fa));}catch(ha){z(ha);}}.bind(ba),'SphericalPhotoRenderer.redux');}else c('Bootloader').loadModules(["CubestripSphericalWebGLRenderer"],function(ga){try{y(new ga(this.__sourceElement,x));}catch(ha){z(ha);}}.bind(ba),'SphericalPhotoRenderer.redux');})();}.bind(this));};v.prototype.__destroy=function(){this.$SphericalPhotoRenderer4();this.$SphericalPhotoRenderer3&&this.$SphericalPhotoRenderer3();j.__destroy.call(this);c('SphericalMediaCanvasPool').release(this.$SphericalPhotoRenderer1,this.$SphericalPhotoRenderer5());this.__sourceElement=c('DOM').create('img');this.__cubemapImageTileProvider=null;this.props.dispatch(n({loaded:false}));};v.prototype.$SphericalPhotoRenderer5=function(){var x=c('PhotoProjection').CUBESTRIP;if(this.props.tiledSphericalConfig.useTiledRenderer){x=c('PhotoProjection').TILED_CUBEMAP;}else if(this.props.photoSphereMetadata.ProjectionType)x=this.props.photoSphereMetadata.ProjectionType;return x+this.props.canvasNamespace;};v.prototype.__showLoadingThumbnail=function(){return !this.props.taggingMode;};v.prototype.$SphericalPhotoRenderer4=function(){var x=this.sphericalRenderer;if(x){var y={avg_frame_render_time:x.getAverageFrameRenderTimeMillis(),avg_texture_to_screen_ratio2:x.getAverageTextureToScreenPixelRatio(),device_pixel_ratio:window.devicePixelRatio||1,dt:x.getTimeSinceFirstRenderMillis(),max_gpu_memory_used:x.getMaxGPUMemoryUsedBytes(),max_tile_level:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getMaxTileLevel():null,render_method:this.props.tiledSphericalConfig.useTiledRenderer?'tiled':'cubestrip',total_data_loaded:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getTotalPixelsLoaded():this.$SphericalPhotoRenderer7(),viewport_height:this.props.height,viewport_width:this.props.width};this.props.dispatch(t(y));}};v.prototype.$SphericalPhotoRenderer7=function(){if(this.__sourceElement&&c('ImageUtils').hasLoaded(this.__sourceElement)){var x=this.__sourceElement,y=x.width,z=x.height;return y*z;}return 0;};v.prototype.$SphericalPhotoRenderer8=function(x){var y,z=this,aa=this.props.dispatch;c('DOM').setAttributes(this.__sourceElement,{crossOrigin:'anonymous',src:x});if(c('ImageUtils').hasLoaded(this.__sourceElement)){aa(s());}else (function(){var ba=c('Event').listen(z.__sourceElement,'load',function(){aa(s());ba.remove();});})();};v.prototype.$SphericalPhotoRenderer9=function(){var x=this.props,y=x.dispatch,z=x.tiledSphericalConfig;if(z.useTiledRenderer&&!this.__cubemapImageTileProvider){var aa=this.props.fbid==='0'?new (c('StaticCubemapTileUriProvider'))(this.props.tiledSphericalConfig.initialTileUris):new (c('EntPhotoCubemapTileUriProvider'))(this.props.fbid,this.props.tiledSphericalConfig.initialTileUris),ba=new (c('CubemapImageTileProvider'))(aa,this.props.tiledSphericalConfig.maxTileLevel);ba.addBaseLevelReadyCallback(function(){return y(s());});this.__cubemapImageTileProvider=ba;}};v.prototype.$SphericalPhotoRenderer6=function(){this.$SphericalPhotoRenderer3=this.props.viewStore.subscribe(this.$SphericalPhotoRenderer10);this.draw(this.__getViewData());var x=this.sphericalRenderer;if(x){var y=c('performanceNow')()-this.$SphericalPhotoRenderer2;this.props.dispatch(o(x,y));}};v.prototype.componentDidMount=function(){var x=this.props.tiledSphericalConfig.useTiledRenderer;if(x){this.$SphericalPhotoRenderer9();}else if(this.props.cubeStripImageURI)this.$SphericalPhotoRenderer8(this.props.cubeStripImageURI);if(this.props.isActive)this.$SphericalPhotoRenderer2=c('performanceNow')();j.componentDidMount.call(this);};v.prototype.componentWillReceiveProps=function(x){this.shouldRender=x.isActive&&!this.props.renderer||x.isActive!==this.props.isActive||x.thumbnail!==this.props.thumbnail||x.width!==this.props.width||x.height!==this.props.height;if(x.isActive&&x.isActive!==this.props.isActive)this.$SphericalPhotoRenderer2=c('performanceNow')();if(this.props.renderer&&x.projectionType!==this.props.projectionType)this.__destroy();var y=this.props.tiledSphericalConfig.useTiledRenderer;if(y){this.$SphericalPhotoRenderer9();}else if(x.cubeStripImageURI&&!this.__sourceElement.src)this.$SphericalPhotoRenderer8(x.cubeStripImageURI);j.componentWillReceiveProps.call(this,x);};v.prototype.componentWillUnmount=function(){this.props.viewStore.dispatch(m(this.props.initialYaw,this.props.initialPitch,this.props.initialFov));j.componentWillUnmount.call(this);};v.__subClassMethods={__afterDraw:true,__beforeCanvasLost:true,__getCanvas:true,__getRenderer:true,__getViewData:true,__onSetupDone:true,__isReadyToSetup:true,__showLoadingThumbnail:true,__onWebGlContextLost:true,__onWebGlInitFailed:true,__onWebGlRenderFailed:true};var w=function x(y){return {className:y.base.className,expansionCoef:y.base.expansionCoef,height:y.base.height,initialFov:y.base.initialFov,initialPitch:y.base.initialPitch,initialYaw:y.base.initialYaw,isActive:y.base.isRendererActive,projectionType:y.base.projectionType,renderer:y.base.renderer,tiledSphericalConfig:y.base.tiledSphericalConfig,width:y.base.width,partialLeftDegrees:y.base.partialLeftDegrees,partialRightDegrees:y.base.partialRightDegrees,partialTopDegrees:y.base.partialTopDegrees,partialBottomDegrees:y.base.partialBottomDegrees,fbid:y.base.fbid,isFetchingData:y.base.isFetchingData,imageLoaded:y.base.loaded,cubeStripImageURI:y.base.src,taggingMode:y.base.taggingMode,thumbnail:y.base.thumbnail,canvasNamespace:y.base.canvasNamespace,src:y.base.src,photoSphereMetadata:y.base.photoSphereMetadata,viewStore:y.base.viewStore};};f.exports=k(w)(v);}),null);
__d('SphericalPhotoStore',['SphericalMediaBaseStore','SphericalMediaBaseReducer'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('SphericalMediaBaseStore'));i=h&&h.prototype;j.prototype.getReducers=function(){return {base:c('SphericalMediaBaseReducer')};};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('getSphericalPhotoErrorDetail',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j,k){return babelHelpers['extends']({},j,{error_message:k?i.message+' | view: '+JSON.stringify(k):i.message,error_stack_trace:i.stack&&i.stack.split&&i.stack.split('at ')[1]});}f.exports=h;}),null);
__d('SphericalPhotoViewerLoggingMiddleware',['SphericalMediaActionNamespaces','SphericalMediaActions','SphericalPhotoViewerLoggerUtil','getSphericalPhotoErrorDetail'],(function a(b,c,d,e,f,g){'use strict';var h=function i(j){var k=j.getState;return function(l){return function(m){var n=k(),o={dt:null,photoID:n.base.fbid,pitch:null,sessionID:n.base.sessionID,surface:n.base.surface,vfov:null,viewportHeight:null,viewportWidth:null,yaw:null};if(m.namespace===c('SphericalMediaActionNamespaces').BASE){switch(m.type){case c('SphericalMediaActions').DRAG_START:c('SphericalPhotoViewerLoggerUtil').logDragStart(o);break;case c('SphericalMediaActions').GYRO_START:c('SphericalPhotoViewerLoggerUtil').logWWWGyroStart(o);break;case c('SphericalMediaActions').ZOOM_START:c('SphericalPhotoViewerLoggerUtil').logZoomStart(o);break;case c('SphericalMediaActions').SIGNIFICANT_MOVE:o.yaw=m.data.view.yaw;o.pitch=m.data.view.pitch;o.vfov=m.data.view.fov;o.viewportHeight=n.base.height;o.viewportWidth=n.base.width;c('SphericalPhotoViewerLoggerUtil').logSignificantMovement(o);break;case c('SphericalMediaActions').MOUSE_ENTER:c('SphericalPhotoViewerLoggerUtil').logMouseOverStart(o);break;case c('SphericalMediaActions').MOUSE_ANIMATION_START:c('SphericalPhotoViewerLoggerUtil').logDragMouseAnimation(o);break;case c('SphericalMediaActions').SETUP_RENDERER:o.dt=m.data.dt;c('SphericalPhotoViewerLoggerUtil').logRendererSetup(o,n.base.tiledSphericalConfig.useTiledRenderer);break;case c('SphericalMediaActions').WEBGL_RENDER_FAILED:c('SphericalPhotoViewerLoggerUtil').logWebGlRenderFailed(o,c('getSphericalPhotoErrorDetail')(m.data.error,{render_method:n.base.tiledSphericalConfig.useTiledRenderer?'tiled':'cubestrip',viewport_height:n.base.height,viewport_width:n.base.width},m.data.view));break;case c('SphericalMediaActions').WEBGL_CONTEXT_LOST:c('SphericalPhotoViewerLoggerUtil').logWebGlContextLost(o);break;case c('SphericalMediaActions').WEBGL_INIT_FAILED:c('SphericalPhotoViewerLoggerUtil').logWebGlInitFailed(o,c('getSphericalPhotoErrorDetail')(m.data.error,{render_method:n.base.tiledSphericalConfig.useTiledRenderer?'tiled':'cubestrip',viewport_height:n.base.height,viewport_width:n.base.width}));break;}}else if(m.type===c('SphericalMediaActions').PHOTO_RENDERER_STATS)c('SphericalPhotoViewerLoggerUtil').logRendererStats(o,m.data);return l(m);};};};f.exports=h;}),null);
__d('SphericalPhotoViewer.react',['cx','BootloadedComponent.react','JSResource','React','SphericalPhotoController.redux','SphericalPhotoViewerLoggingMiddleware','SphericalPhotoRenderer.redux','SphericalPhotoConfig','SphericalPhotoStore','ReactRedux','SphericalMediaCoreActions','SphericalMediaBaseActions','SphericalMediaViewActions'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('ReactRedux').Provider,l=c('SphericalMediaCoreActions').turnOn,m=c('SphericalMediaCoreActions').turnOff,n=c('SphericalMediaBaseActions').updateBase,o=c('SphericalMediaBaseActions').updateDimension,p=c('SphericalMediaViewActions').updateView;i=babelHelpers.inherits(q,c('React').PureComponent);j=i&&i.prototype;function q(r){j.constructor.call(this,r);this.__store=new (c('SphericalPhotoStore'))(this.__getMiddleware()).getStore();}q.prototype.componentWillUnmount=function(){this.__store.dispatch(m());};q.prototype.componentWillMount=function(){this.__updateState();this.__store.dispatch(l());};q.prototype.componentDidUpdate=function(){this.__updateState();};q.prototype.__getMiddleware=function(){var r=this.props.middlewares||[];return r.concat([c('SphericalPhotoViewerLoggingMiddleware')]);};q.prototype.__updateState=function(){var r={enableGyro:this.props.enableGyro,enableZoom:this.props.enableZoom,enableRubberBanding:this.props.enableRubberBanding,visibility:true};if(this.props.partialLimits)r=babelHelpers['extends']({},r,this.props.partialLimits);this.__store.dispatch(n(babelHelpers['extends']({enableTagging:c('SphericalPhotoConfig').www_can_viewer_tag,initialYaw:this.props.initialView.yaw,initialPitch:this.props.initialView.pitch,initialFov:this.props.initialView.fov,tiledSphericalConfig:this.props.tiledSphericalConfig,caption:this.props.caption,canvasNamespace:this.props.canvasNamespace,fbid:this.props.photoID,photoSphereMetadata:this.props.photoSphereMetadata||{},src:this.props.cubeImageURI,surface:this.props.surface,thumbnail:this.props.initialImageURI||''},r)));this.__store.dispatch(o(this.props.width,this.props.height));var s=this.__store.getState().base.viewStore;s.dispatch(p({yaw:this.props.initialView.yaw,pitch:this.props.initialView.pitch,fov:this.props.initialView.fov}));};q.prototype.render=function(){return c('React').createElement(k,{store:this.__store},c('React').createElement('div',{className:"_3o6m _5nxw"},c('React').createElement(c('SphericalPhotoRenderer.redux'),null),this.__store.getState().base.enableTagging?c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalPhotoTagging.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}):null,c('React').createElement(c('SphericalPhotoController.redux'),null),c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalPhotoHeadingIndicator.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}),this.props.showMouseAnimation?c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalMediaMouseOverlay.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}):null,this.props.showGyroAnimation?c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('SphericalMediaGyroOverlay.redux').__setRef('SphericalPhotoViewer.react'),bootloadPlaceholder:c('React').createElement('span',null)}):null));};q.defaultProps={canvasNamespace:'PhotoViewer',enableGyro:false,enableRubberBanding:false,enablevisibilityObserver:false,enableZoom:false,showGyroAnimation:false,showMouseAnimation:true};f.exports=q;}),null);
__d('SphericalPhotoViewerInFeed.react',['cx','Arbiter','Bootloader','CSS','Event','ReactDOM','SphericalMediaActions','SphericalPhotoViewer.react','SubscriptionsHandler','getElementRect','onViewportChanged','debounce','SphericalMediaCoreActions','SphericalMediaBaseActions'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('SphericalMediaCoreActions').turnOn,l=c('SphericalMediaCoreActions').turnOff,m=c('SphericalMediaBaseActions').visibilityChanged,n=5000,o=50;i=babelHelpers.inherits(p,c('SphericalPhotoViewer.react'));j=i&&i.prototype;function p(){var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=j.constructor).call.apply(q,[this].concat(t)),this.$SphericalPhotoViewerInFeed6=false,this.$SphericalPhotoViewerInFeed13=function(){if(this.$SphericalPhotoViewerInFeed14())return;if(this.$SphericalPhotoViewerInFeed8&&this.$SphericalPhotoViewerInFeed8.isOpen)return;this.__store.dispatch(k());}.bind(this),this.$SphericalPhotoViewerInFeed12=c('debounce')(function(v){if(!this.$SphericalPhotoViewerInFeed5)return;var w=c('getElementRect')(this.$SphericalPhotoViewerInFeed5),x=v.bottom-v.top,y=w.bottom-w.top,z=(x-y)/3,aa=v.top+z,ba=v.bottom-z,ca=w.top>aa&&w.top<ba||w.bottom>aa&&w.bottom<ba||aa>w.top&&ba<w.bottom;if(this.$SphericalPhotoViewerInFeed3!==ca){this.$SphericalPhotoViewerInFeed3=ca;ca?this.$SphericalPhotoViewerInFeed15():this.$SphericalPhotoViewerInFeed16();}}.bind(this),o),r;}p.prototype.__getMiddleware=function(){var q=j.__getMiddleware.call(this),r=function(){return function(u){return function(v){if(v.type===c('SphericalMediaActions').VIEWPORT_CLICKED)c('Bootloader').loadModules(["PhotoSnowlift"],function(w){w.bootstrap(this.props.permalinkURI);this.$SphericalPhotoViewerInFeed8=w.getInstance();}.bind(this),'SphericalPhotoViewerInFeed.react');return u(v);}.bind(this);}.bind(this);}.bind(this),s=function(){return function(u){return function(v){if(v.type===c('SphericalMediaActions').TURN_ON)this.$SphericalPhotoViewerInFeed9();if(v.type===c('SphericalMediaActions').SETUP_RENDERER)this.$SphericalPhotoViewerInFeed10();return u(v);}.bind(this);}.bind(this);}.bind(this),t=function(){return function(u){return function(v){if(v.type===c('SphericalMediaActions').TURN_OFF){this.$SphericalPhotoViewerInFeed3=false;c('CSS').show(this.props.loadingElement);this.$SphericalPhotoViewerInFeed11();}return u(v);}.bind(this);}.bind(this);}.bind(this);return q.concat([r,s,t]);};p.prototype.componentDidMount=function(){this.__updateState();this.$SphericalPhotoViewerInFeed11();var q=c('onViewportChanged')(this.$SphericalPhotoViewerInFeed12);this.$SphericalPhotoViewerInFeed1=c('Arbiter').subscribe('PhotoSnowlift.CLOSE',function(){this.$SphericalPhotoViewerInFeed3=false;q.scheduleCheck();}.bind(this));this.$SphericalPhotoViewerInFeed2=c('Arbiter').subscribe('PhotoSnowlift.OPEN',function(){c('Bootloader').loadModules(["PhotoSnowlift"],function(t){this.$SphericalPhotoViewerInFeed8=t.getInstance();}.bind(this),'SphericalPhotoViewerInFeed.react');}.bind(this));this.$SphericalPhotoViewerInFeed3=false;var r=new (c('SubscriptionsHandler'))(),s=c('ReactDOM').findDOMNode(this);r.addSubscriptions(c('Event').listen(s,'mouseenter',this.$SphericalPhotoViewerInFeed13),c('Event').listen(s,'touchstart',this.$SphericalPhotoViewerInFeed13));q.scheduleCheck();this.$SphericalPhotoViewerInFeed4=q;this.$SphericalPhotoViewerInFeed7=r;this.$SphericalPhotoViewerInFeed5=s;};p.prototype.componentWillMount=function(){this.__updateState();};p.prototype.componentWillUnmount=function(){if(this.$SphericalPhotoViewerInFeed1){c('Arbiter').unsubscribe(this.$SphericalPhotoViewerInFeed1);this.$SphericalPhotoViewerInFeed1=null;}if(this.$SphericalPhotoViewerInFeed2){c('Arbiter').unsubscribe(this.$SphericalPhotoViewerInFeed2);this.$SphericalPhotoViewerInFeed2=null;}this.$SphericalPhotoViewerInFeed4&&this.$SphericalPhotoViewerInFeed4.remove();this.$SphericalPhotoViewerInFeed4=null;this.$SphericalPhotoViewerInFeed7&&this.$SphericalPhotoViewerInFeed7.release();this.$SphericalPhotoViewerInFeed7=null;this.$SphericalPhotoViewerInFeed5=null;j.componentWillUnmount.call(this);};p.prototype.$SphericalPhotoViewerInFeed9=function(){c('CSS').addClass(this.props.loadingElement,"_2dz7");c('CSS').removeClass(this.props.loadingElement,"_3s0i");};p.prototype.$SphericalPhotoViewerInFeed11=function(){c('CSS').removeClass(this.props.loadingElement,"_2dz7");c('CSS').addClass(this.props.loadingElement,"_3s0i");};p.prototype.$SphericalPhotoViewerInFeed10=function(){c('CSS').removeClass(this.props.loadingElement,"_2dz7");setTimeout(function(){return c('CSS').hide(this.props.loadingElement);}.bind(this),300);};p.prototype.$SphericalPhotoViewerInFeed14=function(){return this.__store.getState().base.isRendererActive;};p.prototype.$SphericalPhotoViewerInFeed16=function(){this.$SphericalPhotoViewerInFeed11();setTimeout(function(){if(!this.$SphericalPhotoViewerInFeed3&&this.$SphericalPhotoViewerInFeed14())this.__store.dispatch(l());}.bind(this),n);this.__store.dispatch(m(false));};p.prototype.$SphericalPhotoViewerInFeed15=function(){this.$SphericalPhotoViewerInFeed13();this.__store.dispatch(m(true));};f.exports=p;}),null);